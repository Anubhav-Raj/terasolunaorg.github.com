<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>5.4. Database access (Mybatis2) &mdash; TERASOLUNA Global Framework Development Guideline 5.0.0-SNAPSHOT documentation</title>
    
    <link rel="stylesheet" href="../_static/solar.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '5.0.0-SNAPSHOT',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="TERASOLUNA Global Framework Development Guideline 5.0.0-SNAPSHOT documentation" href="../index.html" />
    <link rel="up" title="5. Architecture in Detail - TERASOLUNA Global Framework" href="index.html" />
    <link rel="next" title="5.5. Exclusive Control" href="ExclusionControl.html" />
    <link rel="prev" title="5.3. Database Access (MyBatis3)" href="DataAccessMyBatis3.html" /><script src="../_static/jquery.treeview.js" type="text/javascript"></script>
<!-- <link href='http://fonts.googleapis.com/css?family=Source+Code+Pro|Open+Sans:300italic,400italic,700italic,400,300,700' rel='stylesheet' type='text/css'> -->
<link href="../_static/solarized-dark.css" rel="stylesheet">
<link href="../_static/jquery.treeview.css" rel="stylesheet">
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ExclusionControl.html" title="5.5. Exclusive Control"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="DataAccessMyBatis3.html" title="5.3. Database Access (MyBatis3)"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">TERASOLUNA Global Framework Development Guideline 5.0.0-SNAPSHOT documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">5. Architecture in Detail - TERASOLUNA Global Framework</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper"><label><input id="scroll" type="checkbox" checked> scroll sidebar</label>

  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">5.4. Database access (Mybatis2)</a><ul>
<li><a class="reference internal" href="#overview">5.4.1. Overview</a><ul>
<li><a class="reference internal" href="#about-mybatis">5.4.1.1. About Mybatis</a></li>
<li><a class="reference internal" href="#about-terasoluna-dao">5.4.1.2. About TERASOLUNA DAO</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-use">5.4.2. How to use</a><ul>
<li><a class="reference internal" href="#pom-xml-settings">5.4.2.1. pom.xml settings</a></li>
<li><a class="reference internal" href="#application-settings">5.4.2.2. Application settings</a><ul>
<li><a class="reference internal" href="#datasource-settings">5.4.2.2.1. Datasource settings</a></li>
<li><a class="reference internal" href="#platformtransactionmanager-settings">5.4.2.2.2. PlatformTransactionManager settings</a></li>
<li><a class="reference internal" href="#terasoluna-dao-settings">5.4.2.2.3. TERASOLUNA DAO settings</a></li>
<li><a class="reference internal" href="#settings-for-lob-handling">5.4.2.2.4. Settings for LOB handling</a></li>
<li><a class="reference internal" href="#mybatis-settings">5.4.2.2.5. Mybatis settings</a></li>
</ul>
</li>
<li><a class="reference internal" href="#implementing-sql-mapping-basic-version">5.4.2.3. Implementing SQL mapping (Basic version)</a><ul>
<li><a class="reference internal" href="#select-element-implementation">5.4.2.3.1. select element implementation</a></li>
<li><a class="reference internal" href="#insert-element-implementation">5.4.2.3.2. &#8220;insert&#8221; element implementation</a></li>
<li><a class="reference internal" href="#update-element-implementation">5.4.2.3.3. &#8220;update&#8221; element implementation</a></li>
<li><a class="reference internal" href="#delete-element-implementation">5.4.2.3.4. &#8220;delete&#8221; element implementation</a></li>
<li><a class="reference internal" href="#procedure-element-implementation">5.4.2.3.5. &#8220;procedure&#8221; element implementation</a></li>
<li><a class="reference internal" href="#sql-element-implementation">5.4.2.3.6. &#8220;sql&#8221; element implementation</a></li>
<li><a class="reference internal" href="#lob-update-implementation">5.4.2.3.7. LOB update implementation</a></li>
<li><a class="reference internal" href="#implementation-for-fetching-lob-type">5.4.2.3.8. Implementation for fetching LOB type</a></li>
</ul>
</li>
<li><a class="reference internal" href="#sql-mapping-implementation-dynamic-sql-version">5.4.2.4. SQL mapping implementation (dynamic SQL version)</a><ul>
<li><a class="reference internal" href="#determining-whether-parameter-object-is-specified">5.4.2.4.1. Determining whether parameter object is specified</a></li>
<li><a class="reference internal" href="#determining-whether-parameter-object-javabean-properties-exist">5.4.2.4.2. Determining whether parameter object (JavaBean) properties exist</a></li>
<li><a class="reference internal" href="#determining-whether-property-value-of-parameter-object-javabean-is-set">5.4.2.4.3. Determining whether property value of parameter object (JavaBean) is set</a></li>
<li><a class="reference internal" href="#determining-the-property-value-of-parameter-object-javabean">5.4.2.4.4. Determining the property value of parameter object (JavaBean)</a></li>
<li><a class="reference internal" href="#common-attributes-of-decision-elements">5.4.2.4.5. Common attributes of decision elements</a></li>
<li><a class="reference internal" href="#collection-iteration">5.4.2.4.6. Collection iteration</a></li>
<li><a class="reference internal" href="#dynamic-sql-blocking">5.4.2.4.7. Dynamic SQL blocking</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-use-querydao">5.4.2.5. How to use QueryDAO</a><ul>
<li><a class="reference internal" href="#single-record-search">5.4.2.5.1. Single record search</a></li>
<li><a class="reference internal" href="#multiple-records-search">5.4.2.5.2. Multiple records search</a></li>
<li><a class="reference internal" href="#pagination-search-terasoluna-dao-standard-function-system">5.4.2.5.3. Pagination search (TERASOLUNA DAO standard function system)</a></li>
<li><a class="reference internal" href="#pagination-search-sql-refinement">5.4.2.5.4. Pagination search (SQL refinement)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-use-updatedao">5.4.2.6. How to use UpdateDAO</a><ul>
<li><a class="reference internal" href="#inserting-a-single-record">5.4.2.6.1. Inserting a single record</a></li>
<li><a class="reference internal" href="#inserting-multiple-records-batch-execution">5.4.2.6.2. Inserting multiple records (batch execution)</a></li>
<li><a class="reference internal" href="#updating-a-single-record">5.4.2.6.3. Updating a single record</a></li>
<li><a class="reference internal" href="#updating-multiple-records-batch-execution">5.4.2.6.4. Updating multiple records (batch execution)</a></li>
<li><a class="reference internal" href="#updating-multiple-records-specifying-where-clause">5.4.2.6.5. Updating multiple records (Specifying WHERE clause)</a></li>
<li><a class="reference internal" href="#deleting-a-single-record">5.4.2.6.6. Deleting a single record</a></li>
<li><a class="reference internal" href="#deleting-multiple-records-batch-execution">5.4.2.6.7. Deleting multiple records (batch execution)</a></li>
<li><a class="reference internal" href="#deleting-multiple-records-specifying-where-clause">5.4.2.6.8. Deleting multiple records (Specifying WHERE clause)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#example-showing-use-of-storedproceduredao">5.4.2.7. Example showing use of StoredProcedureDAO</a></li>
<li><a class="reference internal" href="#example-showing-use-of-queryrowhandledao">5.4.2.8. Example showing use of QueryRowHandleDAO</a></li>
<li><a class="reference internal" href="#escaping-during-like-search">5.4.2.9. Escaping during LIKE search</a><ul>
<li><a class="reference internal" href="#how-to-use-escaping-when-matching-method-is-specified-in-query">5.4.2.9.1. How to use escaping when matching method is specified in Query</a></li>
<li><a class="reference internal" href="#how-to-use-escaping-when-the-matching-method-is-specified-in-logic">5.4.2.9.2. How to use escaping when the matching method is specified in Logic</a></li>
</ul>
</li>
<li><a class="reference internal" href="#about-the-measures-to-be-taken-against-sql-injection">5.4.2.10. About the measures to be taken against SQL Injection</a><ul>
<li><a class="reference internal" href="#embedding-values-using-bind-variable">5.4.2.10.1. Embedding values using bind variable</a></li>
<li><a class="reference internal" href="#how-to-embed-a-value-using-substitution-variable">5.4.2.10.2. How to embed a value using substitution variable</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#appendix">5.4.3. Appendix</a><ul>
<li><a class="reference internal" href="#implementation-wherein-related-objects-are-fetched-collectively-by-a-single-sql">5.4.3.1. Implementation wherein related objects are fetched collectively by a single SQL</a></li>
</ul>
</li>
</ul>
</li>
</ul>


  <h4>Previous topic</h4>
  <p class="topless"><a href="DataAccessMyBatis3.html"
                        title="previous chapter">5.3. Database Access (MyBatis3)</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="ExclusionControl.html"
                        title="next chapter">5.5. Exclusive Control</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/ArchitectureInDetail/DataAccessMybatis2.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="database-access-mybatis2">
<h1>5.4. Database access (Mybatis2)<a class="headerlink" href="#database-access-mybatis2" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#overview" id="id1">Overview</a><ul>
<li><a class="reference internal" href="#about-mybatis" id="id2">About Mybatis</a></li>
<li><a class="reference internal" href="#about-terasoluna-dao" id="id3">About TERASOLUNA DAO</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-use" id="id4">How to use</a><ul>
<li><a class="reference internal" href="#pom-xml-settings" id="id5">pom.xml settings</a></li>
<li><a class="reference internal" href="#application-settings" id="id6">Application settings</a><ul>
<li><a class="reference internal" href="#datasource-settings" id="id7">Datasource settings</a></li>
<li><a class="reference internal" href="#platformtransactionmanager-settings" id="id8">PlatformTransactionManager settings</a></li>
<li><a class="reference internal" href="#terasoluna-dao-settings" id="id9">TERASOLUNA DAO settings</a></li>
<li><a class="reference internal" href="#settings-for-lob-handling" id="id10">Settings for LOB handling</a></li>
<li><a class="reference internal" href="#mybatis-settings" id="id11">Mybatis settings</a></li>
</ul>
</li>
<li><a class="reference internal" href="#implementing-sql-mapping-basic-version" id="id12">Implementing SQL mapping (Basic version)</a><ul>
<li><a class="reference internal" href="#select-element-implementation" id="id13">select element implementation</a></li>
<li><a class="reference internal" href="#insert-element-implementation" id="id14">&#8220;insert&#8221; element implementation</a></li>
<li><a class="reference internal" href="#update-element-implementation" id="id15">&#8220;update&#8221; element implementation</a></li>
<li><a class="reference internal" href="#delete-element-implementation" id="id16">&#8220;delete&#8221; element implementation</a></li>
<li><a class="reference internal" href="#procedure-element-implementation" id="id17">&#8220;procedure&#8221; element implementation</a></li>
<li><a class="reference internal" href="#sql-element-implementation" id="id18">&#8220;sql&#8221; element implementation</a></li>
<li><a class="reference internal" href="#lob-update-implementation" id="id19">LOB update implementation</a></li>
<li><a class="reference internal" href="#implementation-for-fetching-lob-type" id="id20">Implementation for fetching LOB type</a></li>
</ul>
</li>
<li><a class="reference internal" href="#sql-mapping-implementation-dynamic-sql-version" id="id21">SQL mapping implementation (dynamic SQL version)</a><ul>
<li><a class="reference internal" href="#determining-whether-parameter-object-is-specified" id="id22">Determining whether parameter object is specified</a></li>
<li><a class="reference internal" href="#determining-whether-parameter-object-javabean-properties-exist" id="id23">Determining whether parameter object (JavaBean) properties exist</a></li>
<li><a class="reference internal" href="#determining-whether-property-value-of-parameter-object-javabean-is-set" id="id24">Determining whether property value of parameter object (JavaBean) is set</a></li>
<li><a class="reference internal" href="#determining-the-property-value-of-parameter-object-javabean" id="id25">Determining the property value of parameter object (JavaBean)</a></li>
<li><a class="reference internal" href="#common-attributes-of-decision-elements" id="id26">Common attributes of decision elements</a></li>
<li><a class="reference internal" href="#collection-iteration" id="id27">Collection iteration</a></li>
<li><a class="reference internal" href="#dynamic-sql-blocking" id="id28">Dynamic SQL blocking</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-use-querydao" id="id29">How to use QueryDAO</a><ul>
<li><a class="reference internal" href="#single-record-search" id="id30">Single record search</a></li>
<li><a class="reference internal" href="#multiple-records-search" id="id31">Multiple records search</a></li>
<li><a class="reference internal" href="#pagination-search-terasoluna-dao-standard-function-system" id="id32">Pagination search (TERASOLUNA DAO standard function system)</a></li>
<li><a class="reference internal" href="#pagination-search-sql-refinement" id="id33">Pagination search (SQL refinement)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-use-updatedao" id="id34">How to use UpdateDAO</a><ul>
<li><a class="reference internal" href="#inserting-a-single-record" id="id35">Inserting a single record</a></li>
<li><a class="reference internal" href="#inserting-multiple-records-batch-execution" id="id36">Inserting multiple records (batch execution)</a></li>
<li><a class="reference internal" href="#updating-a-single-record" id="id37">Updating a single record</a></li>
<li><a class="reference internal" href="#updating-multiple-records-batch-execution" id="id38">Updating multiple records (batch execution)</a></li>
<li><a class="reference internal" href="#updating-multiple-records-specifying-where-clause" id="id39">Updating multiple records (Specifying WHERE clause)</a></li>
<li><a class="reference internal" href="#deleting-a-single-record" id="id40">Deleting a single record</a></li>
<li><a class="reference internal" href="#deleting-multiple-records-batch-execution" id="id41">Deleting multiple records (batch execution)</a></li>
<li><a class="reference internal" href="#deleting-multiple-records-specifying-where-clause" id="id42">Deleting multiple records (Specifying WHERE clause)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#example-showing-use-of-storedproceduredao" id="id43">Example showing use of StoredProcedureDAO</a></li>
<li><a class="reference internal" href="#example-showing-use-of-queryrowhandledao" id="id44">Example showing use of QueryRowHandleDAO</a></li>
<li><a class="reference internal" href="#escaping-during-like-search" id="id45">Escaping during LIKE search</a><ul>
<li><a class="reference internal" href="#how-to-use-escaping-when-matching-method-is-specified-in-query" id="id46">How to use escaping when matching method is specified in Query</a></li>
<li><a class="reference internal" href="#how-to-use-escaping-when-the-matching-method-is-specified-in-logic" id="id47">How to use escaping when the matching method is specified in Logic</a></li>
</ul>
</li>
<li><a class="reference internal" href="#about-the-measures-to-be-taken-against-sql-injection" id="id48">About the measures to be taken against SQL Injection</a><ul>
<li><a class="reference internal" href="#embedding-values-using-bind-variable" id="id49">Embedding values using bind variable</a></li>
<li><a class="reference internal" href="#how-to-embed-a-value-using-substitution-variable" id="id50">How to embed a value using substitution variable</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#appendix" id="id51">Appendix</a><ul>
<li><a class="reference internal" href="#implementation-wherein-related-objects-are-fetched-collectively-by-a-single-sql" id="id52">Implementation wherein related objects are fetched collectively by a single SQL</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="overview">
<h2><a class="toc-backref" href="#id1">5.4.1. Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line">This chapter describes how to access database using MyBatis2.x.</div>
<div class="line">This guideline presumes the use of TERASOLUNA DAO (Mybatis DAO wrapper).</div>
</div>
<blockquote>
<div><div class="figure align-center">
<a class="reference internal image-reference" href="../_images/dataaccess_mybatis.png"><img alt="Target of description" src="../_images/dataaccess_mybatis.png" style="width: 100%;" /></a>
<p class="caption"><strong>Picture - Target of description</strong></p>
</div>
</div></blockquote>
<div class="section" id="about-mybatis">
<h3><a class="toc-backref" href="#id2">5.4.1.1. About Mybatis</a><a class="headerlink" href="#about-mybatis" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">Mybatis is a type of O/R Mapper. The idea behind developing MyBatis is to use it for mapping the SQL statements to objects,</div>
<div class="line">rather than for mapping the database records to the objects.</div>
<div class="line">Thus, this O/R Mapper can be effectively used to access de-normalized databases or to obtain full control of SQL execution.</div>
<div class="line">For details of Mybatis2.x, refer to <a class="reference external" href="https://mybatis.googlecode.com/files/MyBatis-SqlMaps-2_en.pdf">Mybatis Developer Guide (PDF)</a>.</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="about-terasoluna-dao">
<h3><a class="toc-backref" href="#id3">5.4.1.2. About TERASOLUNA DAO</a><a class="headerlink" href="#about-terasoluna-dao" title="Permalink to this headline">¶</a></h3>
<p>TERASOLUNA DAO provides a DAO interface for hiding processes dependent on O/R Mapper and a DAO implementation class which uses Mybatis2.x.</p>
<p>DAO interfaces provided by TERASOLUNA DAO are as follows:</p>
<blockquote>
<div><table border="1" class="docutils">
<caption><strong>DAO interfaces provided by TERASOLUNA DAO</strong></caption>
<colgroup>
<col width="10%" />
<col width="35%" />
<col width="55%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Class name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td><div class="first last line-block">
<div class="line">jp.terasoluna.fw.dao.</div>
<div class="line">QueryDAO</div>
</div>
</td>
<td>DAO interface for executing QuerySQL</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td><div class="first last line-block">
<div class="line">jp.terasoluna.fw.dao.</div>
<div class="line">UpdateDAO</div>
</div>
</td>
<td>DAO interface for executing UpdateSQL</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td><div class="first last line-block">
<div class="line">jp.terasoluna.fw.dao.</div>
<div class="line">StoredProcedureDAO</div>
</div>
</td>
<td>DAO interface for executing StoredProcedure</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="4">
<li></li>
</ol>
</td>
<td><div class="first last line-block">
<div class="line">jp.terasoluna.fw.dao.</div>
<div class="line">QueryRowHandleDAO</div>
</div>
</td>
<td>DAO interface to process each record fetched by executing QuerySQL.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Basic flow to access database using TERASOLUNA DAO (Mybatis implementation) is shown below.</p>
<blockquote>
<div><div class="figure align-center">
<a class="reference internal image-reference" href="../_images/dataaccess_mybatis_basic_flow.png"><img alt="Basic flow of TERASOLUNA DAO" src="../_images/dataaccess_mybatis_basic_flow.png" style="width: 100%;" /></a>
<p class="caption"><strong>Picture - Basic flow of TERASOLUNA DAO</strong></p>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Call the DAO interface method of TERASOLUNA DAO, from Service or Repository.</div>
<div class="line">Pass the object which holds the values to be embedded in SQLID and SQL, as the calling parameter of the method.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">TERASOLUNA DAO delegates the process to Mybatis API.</div>
<div class="line">The object which holds the values to be embedded in SQL and the SQLID specified from Service or Repository, are also passed to Mybatis.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Mybatis fetches the SQL corresponding to the specified SQLID from configuration file (<tt class="docutils literal"><span class="pre">sqlMap.xml</span></tt>), and passes the SQL and bind value to JDBC driver.</div>
<div class="line">(<tt class="docutils literal"><span class="pre">java.sql.PreparedStatement</span></tt> API is used for actual bind value).</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td>JDBC driver executes the SQL by sending the bind value and passed SQL to database.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="how-to-use">
<h2><a class="toc-backref" href="#id4">5.4.2. How to use</a><a class="headerlink" href="#how-to-use" title="Permalink to this headline">¶</a></h2>
<div class="section" id="pom-xml-settings">
<h3><a class="toc-backref" href="#id5">5.4.2.1. pom.xml settings</a><a class="headerlink" href="#pom-xml-settings" title="Permalink to this headline">¶</a></h3>
<p>To use MyBatis2 (TERASOLUNA DAO) in infrastructure layers, add the following dependency to pom.xml.</p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- (1) --&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.terasoluna.gfw<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>terasoluna-gfw-mybatis2<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Add <tt class="docutils literal"><span class="pre">terasoluna-gfw-mybatis2</span></tt> that defines the library group relevant to MyBatis2, to dependency.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="application-settings">
<h3><a class="toc-backref" href="#id6">5.4.2.2. Application settings</a><a class="headerlink" href="#application-settings" title="Permalink to this headline">¶</a></h3>
<div class="section" id="datasource-settings">
<h4><a class="toc-backref" href="#id7">5.4.2.2.1. Datasource settings</a><a class="headerlink" href="#datasource-settings" title="Permalink to this headline">¶</a></h4>
<p>For datasource settings, refer to the common version <a class="reference internal" href="DataAccessCommon.html#data-access-common-howtouse-datasource"><em>Datasource settings</em></a>.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="platformtransactionmanager-settings">
<h4><a class="toc-backref" href="#id8">5.4.2.2.2. PlatformTransactionManager settings</a><a class="headerlink" href="#platformtransactionmanager-settings" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">To use local transactions, perform the following settings.</div>
</div>
<blockquote>
<div>When a local transaction is used, call the API of JDBC and use <tt class="docutils literal"><span class="pre">org.springframework.jdbc.datasource.DataSourceTransactionManager</span></tt> that performs transaction control.</div></blockquote>
<ul class="simple">
<li>xxx-env.xml</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;transactionManager&quot;</span>
    <span class="na">class=</span><span class="s">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;dataSource&quot;</span> <span class="na">ref=</span><span class="s">&quot;dataSource&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (2) --&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>Specify <tt class="docutils literal"><span class="pre">org.springframework.jdbc.datasource.DataSourceTransactionManager</span></tt>.</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td>Specify the bean of configured datasource.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>To use the transaction manager provided by application server, perform the following settings.</p>
<blockquote>
<div>When transaction manager provided by application server is used, call the API of JTA and use <tt class="docutils literal"><span class="pre">org.springframework.transaction.jta.JtaTransactionManager</span></tt> that performs transaction control.</div></blockquote>
<ul class="simple">
<li>xxx-env.xml</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;tx:jta-transaction-manager</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Using  <tt class="docutils literal"><span class="pre">&quot;transactionManager&quot;</span></tt> id, bean is defined for <tt class="docutils literal"><span class="pre">JtaTransactionManager</span></tt>, which is the most appropriate transaction manager for the application server on which the application is deployed,</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="terasoluna-dao-settings">
<h4><a class="toc-backref" href="#id9">5.4.2.2.3. TERASOLUNA DAO settings</a><a class="headerlink" href="#terasoluna-dao-settings" title="Permalink to this headline">¶</a></h4>
<p>Define the beans for factory class of <tt class="docutils literal"><span class="pre">SqlMapClient</span></tt> provided by Spring Framework and TERASOLUNA DAO.</p>
<ul class="simple">
<li>xxx-infra.xml</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;sqlMapClient&quot;</span>
    <span class="na">class=</span><span class="s">&quot;org.springframework.orm.ibatis.SqlMapClientFactoryBean&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;configLocations&quot;</span>
        <span class="na">value=</span><span class="s">&quot;classpath*:/META-INF/mybatis/config/*sqlMapConfig.xml&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (2) --&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;mappingLocations&quot;</span>
        <span class="na">value=</span><span class="s">&quot;classpath*:/META-INF/mybatis/sql/**/*-sqlmap.xml&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (3) --&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;dataSource&quot;</span> <span class="na">ref=</span><span class="s">&quot;dataSource&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (4) --&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;queryDAO&quot;</span>
    <span class="na">class=</span><span class="s">&quot;jp.terasoluna.fw.dao.ibatis.QueryDAOiBatisImpl&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (5) --&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;sqlMapClient&quot;</span> <span class="na">ref=</span><span class="s">&quot;sqlMapClient&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (6) --&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="c">&lt;!-- (5) (6) --&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;updateDAO&quot;</span>
    <span class="na">class=</span><span class="s">&quot;jp.terasoluna.fw.dao.ibatis.UpdateDAOiBatisImpl&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;sqlMapClient&quot;</span> <span class="na">ref=</span><span class="s">&quot;sqlMapClient&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="c">&lt;!-- (5) (6) --&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;spDAO&quot;</span>
    <span class="na">class=</span><span class="s">&quot;jp.terasoluna.fw.dao.ibatis.StoredProcedureDAOiBatisImpl&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;sqlMapClient&quot;</span> <span class="na">ref=</span><span class="s">&quot;sqlMapClient&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="c">&lt;!-- (5) (6) --&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;queryRowHandleDAO&quot;</span>
    <span class="na">class=</span><span class="s">&quot;jp.terasoluna.fw.dao.ibatis.QueryRowHandleDAOiBatisImpl&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;sqlMapClient&quot;</span> <span class="na">ref=</span><span class="s">&quot;sqlMapClient&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>Specify <tt class="docutils literal"><span class="pre">org.springframework.orm.ibatis.SqlMapClientFactoryBean</span></tt> as the factory class of <tt class="docutils literal"><span class="pre">SqlMapClient</span></tt> class.</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the location of Mybatis configuration file.</div>
<div class="line">In this example, it is the file that ends with &#8221; <tt class="docutils literal"><span class="pre">sqlMapConfig.xml</span></tt> &#8221; stored in &#8220;<tt class="docutils literal"><span class="pre">/META-INF/mybatis/config/</span></tt>&#8221; directory in class path.</div>
<div class="line">For configuration file, refer to <a class="reference internal" href="#sqlmapconfig-label"><em>Mybatis settings</em></a>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the location of Mybatis SQL mapping file.</div>
<div class="line">In this example, it is the file that ends with &#8221; <tt class="docutils literal"><span class="pre">-sqlmap.xml</span></tt>&#8221; stored under &#8220;<tt class="docutils literal"><span class="pre">/META-INF/mybatis/sql/</span></tt>&#8221; directory (including sub-directory) in class path.</div>
<div class="line">For SQL mapping file, refer to <a class="reference internal" href="#sqlmap-label"><em>Implementing SQL mapping (Basic version)</em></a>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td>Specify the bean for the configured datasource.</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td>Define the bean by specifying Mybatis implementation class of TERASOLUNA DAO.</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td>Specify the bean for the factory class of <tt class="docutils literal"><span class="pre">SqlMapClient</span></tt> class defined in (1).</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="settings-for-lob-handling">
<h4><a class="toc-backref" href="#id10">5.4.2.2.4. Settings for LOB handling</a><a class="headerlink" href="#settings-for-lob-handling" title="Permalink to this headline">¶</a></h4>
<p>When Large Object like BLOB or CLOB is to be handled, specify <tt class="docutils literal"><span class="pre">LobHandler</span></tt> in the factory class of <tt class="docutils literal"><span class="pre">SqlMapClient</span></tt> class.</p>
<ul class="simple">
<li>xxx-infra.xml</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre> <span class="c">&lt;!-- (1) --&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;nativeJdbcExtractor&quot;</span>
    <span class="na">class=</span><span class="s">&quot;org.springframework.jdbc.support.nativejdbc.SimpleNativeJdbcExtractor&quot;</span> <span class="nt">/&gt;</span>

<span class="c">&lt;!-- (2) --&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;lobHandler&quot;</span> <span class="na">class=</span><span class="s">&quot;org.springframework.jdbc.support.lob.OracleLobHandler&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;nativeJdbcExtractor&quot;</span> <span class="na">ref=</span><span class="s">&quot;nativeJdbcExtractor&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (3) --&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;sqlMapClient&quot;</span>
    <span class="na">class=</span><span class="s">&quot;org.springframework.orm.ibatis.SqlMapClientFactoryBean&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;configLocations&quot;</span>
        <span class="na">value=</span><span class="s">&quot;classpath*:/META-INF/mybatis/config/*sqlMapConfig.xml&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;mappingLocations&quot;</span>
        <span class="na">value=</span><span class="s">&quot;classpath*:/META-INF/mybatis/sql/**/*-sqlmap.xml&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;dataSource&quot;</span> <span class="na">ref=</span><span class="s">&quot;dataSource&quot;</span> <span class="nt">/&gt;</span>
   <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;lobHandler&quot;</span> <span class="na">ref=</span><span class="s">&quot;lobHandler&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (4) --&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Define bean for the implementation class of <tt class="docutils literal"><span class="pre">org.springframework.jdbc.support.nativejdbc.NativeJdbcExtractor</span></tt> interface.</div>
<div class="line">In this example, <tt class="docutils literal"><span class="pre">org.springframework.jdbc.support.nativejdbc.SimpleNativeJdbcExtractor</span></tt> is specified.</div>
<div class="line">However, at times, native datasource cannot be fetched in AP servers other than Tomcat.</div>
<div class="line">Therefore, it is either necessary to specify another NativeJdbcExtractor provided by Spring or create a new <tt class="docutils literal"><span class="pre">NativeJdbcExtractor</span></tt> for each AP server.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Define bean for the implementation class of <tt class="docutils literal"><span class="pre">org.springframework.jdbc.support.lob.LobHandler</span></tt> interface.</div>
<div class="line">In this example, the <tt class="docutils literal"><span class="pre">org.springframework.jdbc.support.lob.OracleLobHandler</span></tt> interface, which is specified when using Oracle is specified.</div>
<div class="line">However, specify <tt class="docutils literal"><span class="pre">org.springframework.jdbc.support.lob.DefaultLobHandler</span></tt> when Oracle is not used.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the bean for  <tt class="docutils literal"><span class="pre">NativeJdbcExtractor</span></tt> defined in (1).</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the bean for <tt class="docutils literal"><span class="pre">LobHandler</span></tt> defined in (3).</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="mybatis-settings">
<span id="sqlmapconfig-label"></span><h4><a class="toc-backref" href="#id11">5.4.2.2.5. Mybatis settings</a><a class="headerlink" href="#mybatis-settings" title="Permalink to this headline">¶</a></h4>
<p>Customize the default operations of <tt class="docutils literal"><span class="pre">SqlMapClient</span></tt>. They should be customized as per the requirement.</p>
<ul class="simple">
<li>sqlMapConfig.xml</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="cp">&lt;!DOCTYPE sqlMapConfig</span>
<span class="cp">            PUBLIC &quot;-//ibatis.apache.org//DTD SQL Map Config 2.0//EN&quot;</span>
<span class="cp">            &quot;http://ibatis.apache.org/dtd/sql-map-config-2.dtd&quot;&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>

<span class="nt">&lt;sqlMapConfig&gt;</span>
    <span class="nt">&lt;settings</span> <span class="na">useStatementNamespaces=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (2) --&gt;</span>
<span class="nt">&lt;/sqlMapConfig&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="6%" />
<col width="94%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>Specify the DTD file. This will enable schema check and IDE code completion.</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td>By setting <tt class="docutils literal"><span class="pre">useStatementNamespaces=&quot;true&quot;</span></tt>, namespace specified in SQL mapping file is used as SQLID.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<ul class="simple">
<li>About sqlMapConfig child elements</li>
</ul>
<blockquote>
<div><div class="line-block">
<div class="line"><tt class="docutils literal"><span class="pre">properties</span></tt>, <tt class="docutils literal"><span class="pre">settings</span></tt>, <tt class="docutils literal"><span class="pre">resultObjectFactory</span></tt>, <tt class="docutils literal"><span class="pre">typeAlias</span></tt>, <tt class="docutils literal"><span class="pre">transactionManager</span></tt> and <tt class="docutils literal"><span class="pre">sqlMap</span></tt> are the child elements.</div>
<div class="line">They should be set if required.</div>
<div class="line">For details, refer to &#8220;The SQL Map XML Configuration File&#8221; (P.8-16) of Mybatis Developer Guide (PDF).</div>
</div>
<table border="1" class="docutils">
<caption><strong>child elements of sqlMapConfig</strong></caption>
<colgroup>
<col width="10%" />
<col width="20%" />
<col width="70%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Elements</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>properties</td>
<td><div class="first last line-block">
<div class="line">Elements for reading a property file. Properties defined in the read property file</div>
<div class="line">can be referred in a <tt class="docutils literal"><span class="pre">&quot;${Property</span> <span class="pre">name}&quot;</span></tt> format from the Mybatis configuration file and SQL mapping file.</div>
<div class="line">It is used while defining environment dependent values or common configuration values.</div>
<div class="line">For details, refer to &#8220;The SQL Map XML Configuration File&#8221; (P.9) of Mybatis Developer Guide (PDF).</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td>settings</td>
<td><div class="first last line-block">
<div class="line">Element for customizing default operations of <tt class="docutils literal"><span class="pre">SqlMapClient</span></tt>.</div>
<div class="line">For details of setting field, refer to &#8220;The SQL Map XML Configuration File&#8221; (P.9-11) of Mybatis Developer Guide (PDF).</div>
</div>
</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td>resultObjectFactory</td>
<td><div class="first last line-block">
<div class="line">Element for specifying the factory class which generates the instance for class specified in the class attribute of resultMap element or the resultClass attribute of select element, statement element and procedure element of SQL mapping file.</div>
<div class="line">When not specified, the instance generated by the default implementation method <tt class="docutils literal"><span class="pre">java.lang.Class#newInstance()</span></tt> is used.</div>
<div class="line">For details, refer to &#8220;The SQL Map XML Configuration File&#8221; (P.11-12) of Mybatis Developer Guide (PDF).</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="4">
<li></li>
</ol>
</td>
<td>typeAlias</td>
<td><div class="first last line-block">
<div class="line">Element for assigning an alias (short name) to class name (FQCN).</div>
<div class="line">The alias name defined here can be used at locations where Mybatis configuration file and SQL mapping file class are specified. Normally, a simple class name without the package name is specified.</div>
<div class="line">For details, refer to &#8220;The SQL Map XML Configuration File&#8221; (P.12) of Mybatis Developer Guide (PDF).</div>
</div>
</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="5">
<li></li>
</ol>
</td>
<td>transactionManager</td>
<td>It is not necessary to define transaction manager since Spring Framework functions are used for transaction management.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="6">
<li></li>
</ol>
</td>
<td>sqlMap</td>
<td>It is not necessary to define sqlMap since it is already set in TERASOLUNA DAO settings.</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
</div>
<div class="section" id="implementing-sql-mapping-basic-version">
<span id="sqlmap-label"></span><h3><a class="toc-backref" href="#id12">5.4.2.3. Implementing SQL mapping (Basic version)</a><a class="headerlink" href="#implementing-sql-mapping-basic-version" title="Permalink to this headline">¶</a></h3>
<p>Basic SQL mapping implementation is shown below.</p>
<p>Implement the SQL to be used in application.</p>
<ul class="simple">
<li>xxx-sqlmap.xml</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="cp">&lt;!DOCTYPE sqlMap</span>
<span class="cp">            PUBLIC &quot;-//ibatis.apache.org//DTD SQL Map 2.0//EN&quot;</span>
<span class="cp">            &quot;http://ibatis.apache.org/dtd/sql-map-2.dtd&quot;&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>

<span class="nt">&lt;sqlMap</span> <span class="na">namespace=</span><span class="s">&quot;xxx&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (2) --&gt;</span>

    <span class="c">&lt;!-- (3) --&gt;</span>
    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;findOne&quot;</span><span class="nt">&gt;</span>
        <span class="c">&lt;!-- ... --&gt;</span>
    <span class="nt">&lt;/select&gt;</span>

    <span class="c">&lt;!-- ... --&gt;</span>

<span class="nt">&lt;/sqlMap&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>Specify the DTD file. This will enable schema check and STS code completion.</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td>Specify namespace.</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td>It is set such that namespace is used as SQLID in <tt class="docutils literal"><span class="pre">sqlMapConfig.xml</span></tt>. Hence, the SQLID specified for executing this SQL is &#8220;<tt class="docutils literal"><span class="pre">xxx.findOne</span></tt>&#8221;.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<ul class="simple">
<li>About sqlMap child elements</li>
</ul>
<blockquote>
<div><p><tt class="docutils literal"><span class="pre">cacheModel</span></tt>, <tt class="docutils literal"><span class="pre">typeAlias</span></tt>, <tt class="docutils literal"><span class="pre">parameterMap</span></tt>, <tt class="docutils literal"><span class="pre">resultMap</span></tt>, <tt class="docutils literal"><span class="pre">select</span></tt>, <tt class="docutils literal"><span class="pre">insert</span></tt>, <tt class="docutils literal"><span class="pre">update</span></tt>, <tt class="docutils literal"><span class="pre">delete</span></tt>, <tt class="docutils literal"><span class="pre">statement</span></tt>, <tt class="docutils literal"><span class="pre">sql</span></tt> and  <tt class="docutils literal"><span class="pre">procedure</span></tt> are the child elements.</p>
<table border="1" class="docutils">
<caption><strong>Child elements of sqlMap</strong></caption>
<colgroup>
<col width="10%" />
<col width="20%" />
<col width="70%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Elements</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>typeAlias</td>
<td>Same as <tt class="docutils literal"><span class="pre">typeAlias</span></tt> of <tt class="docutils literal"><span class="pre">sqlMapConfig.xml</span></tt>.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td>cacheModel</td>
<td>Element defining an object cache</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td>parameterMap</td>
<td>Element defining the mapping of SQL bind parameters (object)</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="4">
<li></li>
</ol>
</td>
<td>resultMap</td>
<td>Element defining the mapping of records and objects returned as SQL execution result</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="5">
<li></li>
</ol>
</td>
<td>select</td>
<td>Element describing SELECT statement</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="6">
<li></li>
</ol>
</td>
<td>insert</td>
<td>Element describing INSERT statement</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="7">
<li></li>
</ol>
</td>
<td>update</td>
<td>Element describing UPDATE statement</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="8">
<li></li>
</ol>
</td>
<td>delete</td>
<td>Element describing DELETE statement</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="9">
<li></li>
</ol>
</td>
<td>statement</td>
<td>Generic elements including elements like <tt class="docutils literal"><span class="pre">select</span></tt>, <tt class="docutils literal"><span class="pre">insert</span></tt>, <tt class="docutils literal"><span class="pre">update</span></tt>, <tt class="docutils literal"><span class="pre">delete</span></tt> and <tt class="docutils literal"><span class="pre">procedure</span></tt>. It is recommended to use individual elements (<tt class="docutils literal"><span class="pre">select</span></tt>, <tt class="docutils literal"><span class="pre">insert</span></tt>, <tt class="docutils literal"><span class="pre">update</span></tt>, <tt class="docutils literal"><span class="pre">delete</span></tt>, <tt class="docutils literal"><span class="pre">procedure</span></tt>).</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="10">
<li></li>
</ol>
</td>
<td>sql</td>
<td>Element describing the SQL statement (part of SQL statement) to be included from <tt class="docutils literal"><span class="pre">select</span></tt>, <tt class="docutils literal"><span class="pre">insert</span></tt>, <tt class="docutils literal"><span class="pre">update</span></tt>, <tt class="docutils literal"><span class="pre">delete</span></tt>, <tt class="docutils literal"><span class="pre">statement</span></tt>. Effective use of these elements enables standardization of duplicate parts used in multiple SQLs.</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="11">
<li></li>
</ol>
</td>
<td>procedure</td>
<td>Element describing PROCEDURE call</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>For details, refer to the following chapters of Mybatis Developer Guide (PDF).</p>
<ul class="last">
<li><div class="first line-block">
<div class="line">The SQL Map XML File (P.17-18)</div>
<div class="line">Simple definition example of SQL mapping file is described.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Mapped Statements (P.18-26)</div>
<div class="line">Basic use of elements for building SQL is described.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Parameter Maps and Inline Parameters (P.27-31)</div>
<div class="line">Mapping of SQL bind parameters (objects) is described in detail.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Substitution Strings (P.32)</div>
<div class="line">SQL bind variables are described.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Result Maps (P.32-41)</div>
<div class="line">Mapping of records and objects returned as SQL execution result is described in detail.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Supported Types for Parameter Maps and Result Maps (P.42-43)</div>
<div class="line">The types and extension methods supported by ParameterMap and ResultMap are described.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Caching Mapped Statement Results (P.44-47)</div>
<div class="line">Cache is described in detail.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Dynamic Mapped Statements (P.48-53)</div>
<div class="line">Dynamic SQL is described in detail.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Simple Dynamic SQL Elements (P.53)</div>
<div class="line">Simple implementation of dynamic SQL is described.</div>
</div>
</li>
</ul>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Appropriate value should be set in fetchSize attribute to describe a query such as, returning a large volume of data using <tt class="docutils literal"><span class="pre">statement</span></tt>, <tt class="docutils literal"><span class="pre">select</span></tt> and <tt class="docutils literal"><span class="pre">procedure</span></tt> elements.
fetchSize attribute is the parameter that sets the number of data records which are retrieved in a single communication between JDBC driver and database.
Default value of each JDBC driver is used when fetchSize attribute is omitted. However, care needs to be taken in case of JDBC driver wherein default value is used to fetch all the records, as it may result in memory exhaustion.</p>
</div>
</div></blockquote>
<div class="section" id="select-element-implementation">
<h4><a class="toc-backref" href="#id13">5.4.2.3.1. select element implementation</a><a class="headerlink" href="#select-element-implementation" title="Permalink to this headline">¶</a></h4>
<p>Define mapping for the searched record column and JavaBean property before implementing select elements.</p>
<ul class="simple">
<li>xxx-sqlmap.xml</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&quot;resultMap_Todo&quot;</span>
           <span class="na">class=</span><span class="s">&quot;xxxxxx.yyyyyy.zzzzzz.domain.model.Todo&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;todoId&quot;</span> <span class="na">column=</span><span class="s">&quot;todo_id&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (2) --&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;todoTitle&quot;</span> <span class="na">column=</span><span class="s">&quot;todo_title&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;finished&quot;</span> <span class="na">column=</span><span class="s">&quot;finished&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;createdAt&quot;</span> <span class="na">column=</span><span class="s">&quot;created_at&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;version&quot;</span> <span class="na">column=</span><span class="s">&quot;version&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/resultMap&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="10%" />
<col width="80%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Attribute</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">-</div>
</div>
</td>
<td>Map the searched records and JavaBean. For details, refer to Developer Guide.</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">id</div>
</div>
</td>
<td>Specify the ID to identify mapping. It is referred from select attribute.</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">class</div>
</div>
</td>
<td>Specify the FQCN of JavaBean to be mapped.</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">-</div>
</div>
</td>
<td>Map JavaBean property with searched record columns.</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">property</div>
</div>
</td>
<td>Specify JavaBean property name.</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">column</div>
</div>
</td>
<td>Specify the column name of the record to be mapped in property specified in &#8220;properties&#8221; attribute.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Implement select element.</p>
<ul class="simple">
<li>xxx-sqlmap.xml</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;findOne&quot;</span>
        <span class="na">parameterClass=</span><span class="s">&quot;java.lang.String&quot;</span>
        <span class="na">resultMap=</span><span class="s">&quot;resultMap_Todo&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (3) --&gt;</span>
    SELECT
        *
    FROM
        todo
    WHERE
        todo_id = #todoId#   /* (4) */
<span class="nt">&lt;/select&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="10%" />
<col width="80%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Attribute</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">-</div>
</div>
</td>
<td>Execute the Search SQL.</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">id</div>
</div>
</td>
<td>Specify the ID for identifying Search SQL.</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">parameterClass</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the type of bind object.</div>
<div class="line">In the example, <tt class="docutils literal"><span class="pre">java.lang.String</span></tt> is specified. However, JavaBean can also be specified when multiple parameters (search conditions) are to be passed.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">resultMap</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the resultMap defined in (1).</div>
<div class="line">It is possible to map automatically to the JavaBean properties specified in class attribute, without using resultMap. However, column name of fetched record should match with the JavaBean property name.</div>
<div class="line">To match the column name of fetched record with JavaBean property name, an alias is assigned to the column using AS clause.
For example, when SQL is set as <tt class="docutils literal"><span class="pre">&quot;SELECT</span> <span class="pre">todo_title</span> <span class="pre">AS</span> <span class="pre">todoTitle,</span> <span class="pre">...&quot;</span></tt>, a value is set to the todoTitle property of JavaBean.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">-</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify bind value in SQL.</div>
<div class="line">In the example, since a single object ( <tt class="docutils literal"><span class="pre">java.lang.String</span></tt> ) is used instead of JavaBean, any name can be specified for bind variable.</div>
<div class="line">When JavaBean is used for bind object, bind variable name must match with the JavaBean property name.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>About automatic mapping</strong></p>
<blockquote>
<div><p>It is possible to map automatically to the JavaBean property specified in resultClass attribute, without using resultMap. However, the column name of fetched record must match with the JavaBean property name.
To match the column name of fetched record with JavaBean property name, an alias is assigned to the column using AS clause. Implementation with auto mapping is shown below.</p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;findOne&quot;</span>
        <span class="na">parameterClass=</span><span class="s">&quot;java.lang.String&quot;</span>
<span class="hll">        <span class="na">resultClass=</span><span class="s">&quot;xxxxxx.yyyyyy.zzzzzz.domain.model.Todo&quot;</span><span class="nt">&gt;</span>
</span>    SELECT
<span class="hll">        todo_id AS todoId,
</span><span class="hll">        todo_title AS todoTitle,
</span>        finished,
<span class="hll">        created_at AS createdAt,
</span>        version
    FROM
        todo
    WHERE
        todo_id = #todoId#
<span class="nt">&lt;/select&gt;</span>
</pre></div>
</div>
</div></blockquote>
<p>Auto mapping is the simplest method for mapping fetched records and JavaBean. However, following restrictions and precautions should be considered while using auto mapping,</p>
</div></blockquote>
<ul class="last simple">
<li>Type declaration and conversion definition of the value fetched in SQL cannot be performed.</li>
<li>Complex mapping (for example, mapping to nested JavaBean) cannot be performed.</li>
<li>There is a slight degradation in performance as <tt class="docutils literal"><span class="pre">java.sql.ResultSetMetaData</span></tt> is accessed during mapping.</li>
</ul>
</div>
</div></blockquote>
</div>
<div class="section" id="insert-element-implementation">
<h4><a class="toc-backref" href="#id14">5.4.2.3.2. &#8220;insert&#8221; element implementation</a><a class="headerlink" href="#insert-element-implementation" title="Permalink to this headline">¶</a></h4>
<p>Implement insert element.</p>
<ul class="simple">
<li>xxx-sqlmap.xml</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;insert</span> <span class="na">id=</span><span class="s">&quot;insert&quot;</span>
        <span class="na">parameterClass=</span><span class="s">&quot;xxxxxx.yyyyyy.zzzzzz.domain.model.Todo&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
    INSERT INTO todo
        (
            todo_id
            ,todo_title
            ,finished
            ,created_at
            ,version
        )
        values(
            #todoId#       /* (2) */
            ,#todoTitle#
            ,#finished#
            ,#createdAt#
            ,1
        )
<span class="nt">&lt;/insert&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="10%" />
<col width="80%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Attribute</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">-</div>
</div>
</td>
<td>Implement Insert SQL.</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">id</div>
</div>
</td>
<td>Specify the ID to identify Insert SQL.</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">parameterClass</div>
</div>
</td>
<td>Specify the type of bind object. JavaBean can also be specified.</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">-</div>
</div>
</td>
<td>Specify the bind value in SQL. When JavaBean is used for bind object, bind variable name must match with the JavaBean property name.</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Type declaration or conversion definition of SQL bind value can be performed by using the parameterMap attribute or &#8220;Inline Parameter Maps&#8221; feature.
For example, when bind value is <tt class="docutils literal"><span class="pre">null</span></tt>, default value can be set. For details, refer to &#8220;Parameter Maps and Inline Parameters&#8221; (P.27-31) of Mybatis Developer Guide (PDF).</p>
</div>
</div></blockquote>
</div>
<div class="section" id="update-element-implementation">
<h4><a class="toc-backref" href="#id15">5.4.2.3.3. &#8220;update&#8221; element implementation</a><a class="headerlink" href="#update-element-implementation" title="Permalink to this headline">¶</a></h4>
<p>Implement update element.</p>
<ul class="simple">
<li>xxx-sqlmap.xml</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;update</span> <span class="na">id=</span><span class="s">&quot;update&quot;</span>
        <span class="na">parameterClass=</span><span class="s">&quot;xxxxxx.yyyyyy.zzzzzz.domain.model.Todo&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
    UPDATE todo SET
        todo_id = #todoId#
        ,todo_title = #todoTitle#
        ,finished = #finished#
        ,version = (#version# + 1)
    WHERE
        todo_id = #todoId#
    AND version = #version#
<span class="nt">&lt;/update&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>Implement Update SQL.</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="delete-element-implementation">
<h4><a class="toc-backref" href="#id16">5.4.2.3.4. &#8220;delete&#8221; element implementation</a><a class="headerlink" href="#delete-element-implementation" title="Permalink to this headline">¶</a></h4>
<p>Implement delete element.</p>
<ul class="simple">
<li>xxx-sqlmap.xml</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;delete</span> <span class="na">id=</span><span class="s">&quot;delete&quot;</span> <span class="na">parameterClass=</span><span class="s">&quot;java.lang.String&quot;</span><span class="nt">&gt;</span>  <span class="c">&lt;!-- (1) --&gt;</span>
    DELETE FROM
        todo
    WHERE
        todo_id = #todoId#
<span class="nt">&lt;/delete&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>Implement Delete SQL.</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="procedure-element-implementation">
<h4><a class="toc-backref" href="#id17">5.4.2.3.5. &#8220;procedure&#8221; element implementation</a><a class="headerlink" href="#procedure-element-implementation" title="Permalink to this headline">¶</a></h4>
<p>Calling the function created in PostgreSQL using procedure element is shown below.</p>
<p>SQL to create functions (PL/pgSQL implementation) and tables is as follows:</p>
<blockquote>
<div><div class="highlight-sql"><div class="highlight"><pre><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">sales</span> <span class="p">(</span>
    <span class="n">itemno</span> <span class="n">INT4</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">quantity</span> <span class="n">INT4</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">price</span> <span class="n">INT4</span> <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">);</span>
</pre></div>
</div>
<div class="highlight-guess"><div class="highlight"><pre><span class="n">CREATE</span>
    <span class="n">FUNCTION</span> <span class="n">sales_item</span><span class="p">(</span><span class="n">p_itemno</span> <span class="n">INT4</span><span class="p">)</span> <span class="n">RETURNS</span> <span class="n">TABLE</span> <span class="p">(</span>
        <span class="n">quantity</span> <span class="n">INT4</span>
        <span class="p">,</span><span class="n">total</span> <span class="n">INT4</span>
    <span class="p">)</span> <span class="n">AS</span> $$ <span class="n">BEGIN</span> <span class="n">RETURN</span> <span class="n">QUERY</span>
        <span class="n">SELECT</span>
                <span class="n">s</span><span class="p">.</span><span class="n">quantity</span>
                <span class="p">,</span><span class="n">s</span><span class="p">.</span><span class="n">quantity</span> <span class="o">*</span> <span class="n">s</span><span class="p">.</span><span class="n">price</span>
            <span class="n">FROM</span>
                <span class="n">sales</span> <span class="n">s</span>
            <span class="n">WHERE</span>
                <span class="n">itemno</span> <span class="p">=</span> <span class="n">p_itemno</span><span class="p">;</span>
<span class="n">END</span><span class="p">;</span>
$$ <span class="n">LANGUAGE</span> <span class="n">plpgsql</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
<p>Implement parameterMap element.</p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- (1) --&gt;</span>
<span class="nt">&lt;parameterMap</span> <span class="na">id=</span><span class="s">&quot;salesItemMap&quot;</span> <span class="na">class=</span><span class="s">&quot;xxxxxx.yyyyyy.zzzzzz.domain.model.SalesItem&quot;</span><span class="nt">&gt;</span>
    <span class="c">&lt;!-- (2) --&gt;</span>
    <span class="nt">&lt;parameter</span> <span class="na">property=</span><span class="s">&quot;id&quot;</span> <span class="na">jdbcType=</span><span class="s">&quot;INTEGER&quot;</span> <span class="na">javaType=</span><span class="s">&quot;java.lang.Integer&quot;</span> <span class="na">mode=</span><span class="s">&quot;IN&quot;</span> <span class="nt">/&gt;</span>
    <span class="c">&lt;!-- (3) --&gt;</span>
    <span class="nt">&lt;parameter</span> <span class="na">property=</span><span class="s">&quot;quantity&quot;</span> <span class="na">jdbcType=</span><span class="s">&quot;INTEGER&quot;</span> <span class="na">javaType=</span><span class="s">&quot;java.lang.Integer&quot;</span> <span class="na">mode=</span><span class="s">&quot;OUT&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;parameter</span> <span class="na">property=</span><span class="s">&quot;total&quot;</span> <span class="na">jdbcType=</span><span class="s">&quot;INTEGER&quot;</span> <span class="na">javaType=</span><span class="s">&quot;java.lang.Integer&quot;</span> <span class="na">mode=</span><span class="s">&quot;OUT&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/parameterMap&gt;</span>
</pre></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span class="c1">// (4)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SalesItem</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">id</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">quantity</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">total</span><span class="o">;</span>
    <span class="c1">// ...</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>Define mapping of IN parameter and OUT parameter to be passed to the function.</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td>Mapping of IN parameter is defined. <tt class="docutils literal"><span class="pre">SalesItem#id</span></tt> is mapped with IN parameter.</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td>Mapping of OUT parameters is defined. 1st OUT parameter is mapped with <tt class="docutils literal"><span class="pre">SalesItem#quantity</span></tt> and the 2nd OUT parameter is mapped with <tt class="docutils literal"><span class="pre">SalesItem#total</span></tt>.</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td>JavaBean to be mapped.</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Mapping can also be carried out with  &#8220;Inline Parameter Maps&#8221; feature, without using parameterMap attribute.
For specific examples, refer to &#8220;Parameter Maps and Inline Parameters&#8221; (P.31) of Mybatis Developer Guide(PDF).</p>
</div>
</div></blockquote>
<p>Implement procedure element.</p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;procedure</span> <span class="na">id=</span><span class="s">&quot;findSalesItem&quot;</span> <span class="na">parameterMap=</span><span class="s">&quot;salesItemMap&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
    {call sales_item(?,?,?)}
<span class="nt">&lt;/procedure&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the Procedure or Function to be called in &#8220;{call Procedure/Function name (IN parameter ...,OUT parameter...)}&#8221; format.</div>
<div class="line">In the example, one IN parameter and two OUT parameters are specified for <tt class="docutils literal"><span class="pre">sales_item</span></tt> function.</div>
<div class="line">Bound values serve as a definition sequence of mapping definitions specified in parameterMap element.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="sql-element-implementation">
<h4><a class="toc-backref" href="#id18">5.4.2.3.6. &#8220;sql&#8221; element implementation</a><a class="headerlink" href="#sql-element-implementation" title="Permalink to this headline">¶</a></h4>
<p>Implement sql element.</p>
<ul class="simple">
<li>xxx-sqlmap.xml</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;sql</span> <span class="na">id=</span><span class="s">&quot;fragment_where_byFinished&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
    WHERE
        finished = #finished#
<span class="nt">&lt;/sql&gt;</span>

<span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;findByFinished&quot;</span>
        <span class="na">parameterClass=</span><span class="s">&quot;Boolean&quot;</span>
        <span class="na">resultMap=</span><span class="s">&quot;resultMap_Todo&quot;</span><span class="nt">&gt;</span>  <span class="c">&lt;!-- (2) --&gt;</span>
    SELECT
        *
    FROM
        todo
    <span class="nt">&lt;include</span> <span class="na">refid=</span><span class="s">&quot;fragment_where_byFinished&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (3) --&gt;</span>
    ORDER BY
        created_at DESC
<span class="nt">&lt;/select&gt;</span>

<span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;countByFinished&quot;</span>
        <span class="na">parameterClass=</span><span class="s">&quot;Boolean&quot;</span>
        <span class="na">resultClass=</span><span class="s">&quot;long&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (4) --&gt;</span>
    SELECT
        count(*)
    FROM
        todo
    <span class="nt">&lt;include</span> <span class="na">refid=</span><span class="s">&quot;fragment_where_byFinished&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (5) --&gt;</span>
<span class="nt">&lt;/select&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>WHERE clause shared by the SQLs of (2) and (4) is defined. SQL to be included should be defined before the SQL that implements &#8216;include&#8217;.</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td>SQL for fetching the data that matches the condition.</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td>Include the SQL implemented by WHERE clause defined in (1).</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td>SQL for fetching data records that match the conditions</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td>Include the SQL implemented by WHERE clause defined in (1).</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="lob-update-implementation">
<span id="data-access-mybatis2-howtouse-lob-update"></span><h4><a class="toc-backref" href="#id19">5.4.2.3.7. LOB update implementation</a><a class="headerlink" href="#lob-update-implementation" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">Implementation for updating Large Objects like BLOB and CLOB in database is shown below.</div>
<div class="line">In the following example, records are inserted in the table that handles BLOB.</div>
</div>
<ul class="simple">
<li>DDL</li>
</ul>
<blockquote>
<div><div class="highlight-sql"><div class="highlight"><pre><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">upload_binary</span> <span class="p">(</span>
    <span class="n">file_id</span> <span class="nb">CHAR</span><span class="p">(</span><span class="mi">36</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">file_name</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">256</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">content</span> <span class="nb">BLOB</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span> <span class="c1">-- (1)</span>
    <span class="k">CONSTRAINT</span> <span class="n">pk_upload_binary</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">file_id</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Define BLOB column.</div>
<div class="line">In the above example, the DDL is assumed to use Oracle as a database.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<ul class="simple">
<li>DTO (JavaBean)</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BinaryFile</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>
    <span class="c1">// omitted</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">fileId</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">fileName</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">InputStream</span> <span class="n">content</span><span class="o">;</span> <span class="c1">// (2)</span>

    <span class="c1">// omitted setter/getter</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Define the property that stores BLOB value in <tt class="docutils literal"><span class="pre">java.io.InputStream</span></tt> type.</div>
<div class="line">In the above example, input stream of uploaded file is set in <tt class="docutils literal"><span class="pre">InputStream</span></tt>.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>It is recommended to always define the type of property that handles BLOB, in <tt class="docutils literal"><span class="pre">InputStream</span></tt> type.
BLOB can also be handled as a byte array. However, it may cause memory exhaustion in case of increased data capacity.</p>
<p class="last">It is recommended to always define the type of property that handles CLOB, in <tt class="docutils literal"><span class="pre">java.io.Reader</span></tt> type.
CLOB can also be handled as a string. However, it may cause memory exhaustion in case of increased data capacity.</p>
</div>
</div></blockquote>
<ul class="simple">
<li>xxx-sqlmap.xml</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;parameterMap</span> <span class="na">id=</span><span class="s">&quot;uploadBinaryParameterMap&quot;</span>
              <span class="na">class=</span><span class="s">&quot;xxxxxx.yyyyyy.zzzzzz.domain.service.BinaryFile&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;parameter</span> <span class="na">property=</span><span class="s">&quot;fileId&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;parameter</span> <span class="na">property=</span><span class="s">&quot;fileName&quot;</span> <span class="nt">/&gt;</span>
    <span class="c">&lt;!-- (3) --&gt;</span>
    <span class="nt">&lt;parameter</span> <span class="na">property=</span><span class="s">&quot;content&quot;</span>
               <span class="na">jdbcType=</span><span class="s">&quot;BLOB&quot;</span>
               <span class="na">typeHandler=</span><span class="s">&quot;jp.terasoluna.fw.orm.ibatis.support.BlobInputStreamTypeHandler&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/parameterMap&gt;</span>

<span class="c">&lt;!-- (4) --&gt;</span>
<span class="nt">&lt;insert</span> <span class="na">id=</span><span class="s">&quot;uploadBinary&quot;</span> <span class="na">parameterMap=</span><span class="s">&quot;uploadBinaryParameterMap&quot;</span><span class="nt">&gt;</span>
    INSERT INTO upload_binary
    (
        file_id
        ,file_name
        ,content
    )
    VALUES
    (
        ?
        ,?
        ,?
    )
<span class="nt">&lt;/insert&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the definition that is necessary to register the parameter that stores the registration values of BLOB column.</div>
<div class="line">Specify <tt class="docutils literal"><span class="pre">&quot;BLOB&quot;</span></tt> in jdbcType attribute and <tt class="docutils literal"><span class="pre">&quot;jp.terasoluna.fw.orm.ibatis.support.BlobInputStreamTypeHandler&quot;</span></tt> in typeHandler attribute.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">SQL to register records in the table with a BLOB column.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">While handling CLOB, specify <tt class="docutils literal"><span class="pre">&quot;CLOB&quot;</span></tt> in jdbcType attribute and <tt class="docutils literal"><span class="pre">&quot;jp.terasoluna.fw.orm.ibatis.support.ClobReaderTypeHandler&quot;</span></tt> in typeHandler attribute.</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>Class name specified in FQCN can be described in a simple manner by assigning an alias to it using typeAlias element.</p>
<blockquote class="last">
<div><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- (5) --&gt;</span>
<span class="nt">&lt;typeAlias</span> <span class="na">alias=</span><span class="s">&quot;BinaryFile&quot;</span>
           <span class="na">type=</span><span class="s">&quot;xxxxxx.yyyyyy.zzzzzz.domain.service.BinaryFile&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;typeAlias</span> <span class="na">alias=</span><span class="s">&quot;BlobInputStreamTypeHandler&quot;</span>
           <span class="na">type=</span><span class="s">&quot;jp.terasoluna.fw.orm.ibatis.support.BlobInputStreamTypeHandler&quot;</span><span class="nt">/&gt;</span>

<span class="nt">&lt;parameterMap</span> <span class="na">id=</span><span class="s">&quot;uploadBinaryParameterMap&quot;</span>
              <span class="na">class=</span><span class="s">&quot;BinaryFile&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (6) --&gt;</span>

    <span class="c">&lt;!-- omitted --&gt;</span>

    <span class="nt">&lt;parameter</span> <span class="na">property=</span><span class="s">&quot;content&quot;</span> <span class="na">jdbcType=</span><span class="s">&quot;BLOB&quot;</span>
               <span class="na">typeHandler=</span><span class="s">&quot;BlobInputStreamTypeHandler&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (6) --&gt;</span>

<span class="nt">&lt;/parameterMap&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Assign an alias to the class name (FQCN) using typeAlias element.</div>
<div class="line">In the above example, an alias is assigned to <tt class="docutils literal"><span class="pre">BinaryFile</span></tt> class and <tt class="docutils literal"><span class="pre">BlobInputStreamTypeHandler</span></tt> class.</div>
<div class="line">typeAlias element can be defined in both <tt class="file docutils literal"><span class="pre">sqlMapConfig.xml</span></tt> and <tt class="file docutils literal"><span class="pre">xxx-sqlmap.xml</span></tt>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the alias name for the class name (FQCN) assigned in (5).</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
</div></blockquote>
<ul class="simple">
<li>Service</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="c1">// omitted</span>

<span class="nd">@Inject</span>
<span class="n">UpdateDAO</span> <span class="n">updateDAO</span><span class="o">;</span>

<span class="c1">// omitted</span>

<span class="kd">public</span> <span class="n">BinaryFile</span> <span class="nf">uploadBinaryFile</span><span class="o">(</span><span class="n">String</span> <span class="n">fileName</span><span class="o">,</span>
        <span class="n">InputStream</span> <span class="n">contentInputStream</span><span class="o">)</span> <span class="o">{</span>

    <span class="c1">// (7)</span>
    <span class="n">BinaryFile</span> <span class="n">inputFile</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BinaryFile</span><span class="o">();</span>
    <span class="n">inputFile</span><span class="o">.</span><span class="na">setFileId</span><span class="o">(</span><span class="n">UUID</span><span class="o">.</span><span class="na">randomUUID</span><span class="o">().</span><span class="na">toString</span><span class="o">());</span>
    <span class="n">inputFile</span><span class="o">.</span><span class="na">setFileName</span><span class="o">(</span><span class="n">fileName</span><span class="o">);</span>
    <span class="n">inputFile</span><span class="o">.</span><span class="na">setContent</span><span class="o">(</span><span class="n">contentInputStream</span><span class="o">);</span>

    <span class="c1">// (8)</span>
    <span class="n">updateDAO</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="s">&quot;example.uploadBinary&quot;</span><span class="o">,</span> <span class="n">inputFile</span><span class="o">);</span>

    <span class="k">return</span> <span class="n">inputFile</span><span class="o">;</span>
<span class="o">}</span>

<span class="c1">// omitted</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set the information required for registering records in DTO.</div>
<div class="line">In the above example, file ID is numbered as UUID and the file name received by argument and the  <tt class="docutils literal"><span class="pre">InputStream</span></tt> object that stores the file contents are set in DTO.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(8)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">With DTO that stores information required for registration as the argument, call <tt class="docutils literal"><span class="pre">UpdateDAO</span></tt>.</div>
<div class="line">Method for calling DAO is same as the method when BLOB is not handled.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<ul class="simple">
<li>Controller</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&quot;uploadBinary&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">uploadBinaryFile</span><span class="o">(</span>
        <span class="nd">@RequestPart</span><span class="o">(</span><span class="s">&quot;file&quot;</span><span class="o">)</span> <span class="n">MultipartFile</span> <span class="n">multipartFile</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="c1">// (9)</span>
    <span class="n">BinaryFile</span> <span class="n">uploadedFile</span> <span class="o">=</span> <span class="n">uploadService</span><span class="o">.</span><span class="na">uploadBinaryFile</span><span class="o">(</span><span class="n">multipartFile</span>
            <span class="o">.</span><span class="na">getOriginalFilename</span><span class="o">(),</span> <span class="n">multipartFile</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">());</span>
    <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="n">uploadedFile</span><span class="o">);</span>
    <span class="k">return</span> <span class="s">&quot;upload/form&quot;</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(9)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Call Service method with uploaded file name and <tt class="docutils literal"><span class="pre">InputStream</span></tt> that stores the file contents in argument.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="implementation-for-fetching-lob-type">
<h4><a class="toc-backref" href="#id20">5.4.2.3.8. Implementation for fetching LOB type</a><a class="headerlink" href="#implementation-for-fetching-lob-type" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">Implementation for fetching Large Objects like BLOB and CLOB from database is shown below.</div>
<div class="line">In the following example, records are fetched from the table that handles BLOB.</div>
<div class="line">For details on DDL and DTO (JavaBean) that are used to create necessary tables, refer to <a class="reference internal" href="#data-access-mybatis2-howtouse-lob-update"><em>LOB update implementation</em></a>.</div>
</div>
<ul class="simple">
<li>xxx-sqlmap.xml</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&quot;selectBinaryResultMap&quot;</span> <span class="na">class=</span><span class="s">&quot;BinaryFile&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;fileId&quot;</span> <span class="na">column=</span><span class="s">&quot;file_id&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;fileName&quot;</span> <span class="na">column=</span><span class="s">&quot;file_name&quot;</span> <span class="nt">/&gt;</span>
    <span class="c">&lt;!-- (1) --&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;content&quot;</span> <span class="na">column=</span><span class="s">&quot;content&quot;</span> <span class="na">jdbcType=</span><span class="s">&quot;BLOB&quot;</span>
            <span class="na">typeHandler=</span><span class="s">&quot;BlobInputStreamTypeHandler&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/resultMap&gt;</span>

<span class="c">&lt;!-- (2) --&gt;</span>
<span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;selectBinary&quot;</span> <span class="na">parameterClass=</span><span class="s">&quot;java.lang.String&quot;</span>
        <span class="na">resultMap=</span><span class="s">&quot;selectBinaryResultMap&quot;</span><span class="nt">&gt;</span>
    SELECT
        *
    FROM
        upload_binary
    WHERE
        file_id = #fileId#
<span class="nt">&lt;/select&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the definition required to fetch the value for the property that stores the value fetched from BLOB column.</div>
<div class="line">Specify <tt class="docutils literal"><span class="pre">&quot;BLOB&quot;</span></tt> in jdbcType attribute and <tt class="docutils literal"><span class="pre">&quot;jp.terasoluna.fw.orm.ibatis.support.BlobInputStreamTypeHandler&quot;</span></tt> in typeHandler attribute.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">SQL for fetching records from the table with BLOB column.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">While handling CLOB, specify <tt class="docutils literal"><span class="pre">&quot;CLOB&quot;</span></tt> in jdbcType attribute and <tt class="docutils literal"><span class="pre">&quot;jp.terasoluna.fw.orm.ibatis.support.ClobReaderTypeHandler&quot;</span></tt> in typeHandler attribute.</p>
</div>
</div></blockquote>
<ul class="simple">
<li>Service / Repository</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="c1">// omitted</span>

<span class="nd">@Inject</span>
<span class="n">QueryDAO</span> <span class="n">queryDAO</span><span class="o">;</span>

<span class="c1">// omitted</span>

<span class="kd">public</span> <span class="n">BinaryFile</span> <span class="nf">getBinaryFile</span><span class="o">(</span><span class="n">String</span> <span class="n">fileId</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// (3)</span>
    <span class="n">BinaryFile</span> <span class="n">loadedFile</span> <span class="o">=</span> <span class="n">queryDAO</span><span class="o">.</span><span class="na">executeForObject</span><span class="o">(</span>
            <span class="s">&quot;article.selectBinary&quot;</span><span class="o">,</span> <span class="n">fileId</span><span class="o">,</span> <span class="n">BinaryFile</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">loadedFile</span><span class="o">;</span>
<span class="o">}</span>

<span class="c1">// omitted</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">With fetch conditions specified by the controller as argument, call <tt class="docutils literal"><span class="pre">QueryDAO</span></tt>.</div>
<div class="line">In the above example, upload file information matching with file ID is fetched.</div>
<div class="line">Method for calling DAO is same as the method when BLOB is not handled.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
</div>
<div class="section" id="sql-mapping-implementation-dynamic-sql-version">
<h3><a class="toc-backref" href="#id21">5.4.2.4. SQL mapping implementation (dynamic SQL version)</a><a class="headerlink" href="#sql-mapping-implementation-dynamic-sql-version" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">There is default mechanism provided in Mybatis to build SQL dynamically.</div>
<div class="line">Methods to build SQL dynamically are given below.</div>
<div class="line">For details, refer to &#8220;Dynamic Mapped Statements&#8221; (P.48-53) of Developer Guide (PDF).</div>
</div>
<div class="section" id="determining-whether-parameter-object-is-specified">
<h4><a class="toc-backref" href="#id22">5.4.2.4.1. Determining whether parameter object is specified</a><a class="headerlink" href="#determining-whether-parameter-object-is-specified" title="Permalink to this headline">¶</a></h4>
<p>SQL can be built by determining whether the parameter object passed to SQL is specified.</p>
<p>Decision elements are as follows:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="15%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Element</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>isParameterPresent</td>
<td>Element for building SQL when parameter object is specified (Not NULL).</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td>isNotParameterPresent</td>
<td>Element for building SQL when parameter object is not specified (NULL).</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Implementation is as follows:</p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;findOne&quot;</span> <span class="na">parameterClass=</span><span class="s">&quot;java.lang.Integer&quot;</span> <span class="na">resultMap=</span><span class="s">&quot;...&quot;</span><span class="nt">&gt;</span>
    SELECT
        *
    FROM
        t_order
    WHERE

    <span class="nt">&lt;isParameterPresent&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
        id = #id#
    <span class="nt">&lt;/isParameterPresent&gt;</span>

    <span class="nt">&lt;isNotParameterPresent&gt;</span> <span class="c">&lt;!-- (2) --&gt;</span>
        1 = 2
    <span class="nt">&lt;/isNotParameterPresent&gt;</span>

    <span class="c">&lt;!-- ... --&gt;</span>

<span class="nt">&lt;/select&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">In the example, id column is set in WHERE clause when the parameter object is specified.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">In the example, the condition &#8220;<tt class="docutils literal"><span class="pre">1=2</span></tt>&#8221; is set so that there are no matching records, when the parameter object is not specified.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Following 2 patterns of SQL are generated by the dynamic SQL mentioned above.</p>
<blockquote>
<div><div class="highlight-sql"><div class="highlight"><pre><span class="c1">-- (1) parameterObject(id)=1</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">t_order</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1">-- (2)</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">t_order</span> <span class="k">WHERE</span> <span class="mi">1</span> <span class="o">=</span> <span class="mi">2</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="determining-whether-parameter-object-javabean-properties-exist">
<h4><a class="toc-backref" href="#id23">5.4.2.4.2. Determining whether parameter object (JavaBean) properties exist</a><a class="headerlink" href="#determining-whether-parameter-object-javabean-properties-exist" title="Permalink to this headline">¶</a></h4>
<p>SQL can be built by determining whether the properties specified in parameter object (JavaBean) passed to SQL, exist.</p>
<p>Decision elements are as follows:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="15%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Element</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>isPropertyAvailable</td>
<td>Element for building SQL when the specified property exists.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td>isNotPropertyAvailable</td>
<td>Element for building SQL when the specified property does not exist.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Implementation is as follows:</p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;findOne&quot;</span> <span class="na">parameterClass=</span><span class="s">&quot;OrderCriteria&quot;</span> <span class="na">resultMap=</span><span class="s">&quot;...&quot;</span><span class="nt">&gt;</span>
    SELECT
        *
    FROM
        t_order
    WHERE

    <span class="nt">&lt;isPropertyAvailable</span> <span class="na">property=</span><span class="s">&quot;statusCode&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
        status_code = #statusCode#
    <span class="nt">&lt;/isPropertyAvailable&gt;</span>

    <span class="nt">&lt;isNotPropertyAvailable</span> <span class="na">property=</span><span class="s">&quot;statusCode&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (2) --&gt;</span>
        <span class="cp">&lt;![CDATA[</span>
<span class="cp">        status_code &lt;&gt; &#39;completed&#39;</span>
<span class="cp">        ]]&gt;</span>
    <span class="nt">&lt;/isNotPropertyAvailable&gt;</span>

    <span class="c">&lt;!-- ... --&gt;</span>

<span class="nt">&lt;/select&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">In the example, when <tt class="docutils literal"><span class="pre">statusCode</span></tt> property exists, WHERE clause is set such that status_code column fetches records matching with <tt class="docutils literal"><span class="pre">statusCode</span></tt>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">In the example, when <tt class="docutils literal"><span class="pre">statusCode</span></tt> property does not exist, WHERE clause is set such that status_code column fetches records other than <tt class="docutils literal"><span class="pre">'completed'</span></tt>.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Following 2 patterns of SQL are generated by dynamic SQL mentioned above.</p>
<blockquote>
<div><div class="highlight-sql"><div class="highlight"><pre><span class="c1">-- (1) statusCode=&#39;checking&#39;</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">t_order</span> <span class="k">WHERE</span> <span class="n">status_code</span> <span class="o">=</span> <span class="s1">&#39;checking&#39;</span>

<span class="c1">-- (2)</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">t_order</span> <span class="k">WHERE</span> <span class="n">status_code</span> <span class="o">&lt;&gt;</span> <span class="s1">&#39;completed&#39;</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="determining-whether-property-value-of-parameter-object-javabean-is-set">
<h4><a class="toc-backref" href="#id24">5.4.2.4.3. Determining whether property value of parameter object (JavaBean) is set</a><a class="headerlink" href="#determining-whether-property-value-of-parameter-object-javabean-is-set" title="Permalink to this headline">¶</a></h4>
<p>SQL can be built by determining whether value is specified in the parameter object (JavaBean) property passed to SQL.</p>
<p>Determination of elements is as follows:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="15%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Element</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>isNull</td>
<td>Element for building SQL when property value is <tt class="docutils literal"><span class="pre">null</span></tt>.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td>isNotNull</td>
<td>Element for building SQL when property value is not <tt class="docutils literal"><span class="pre">null</span></tt>.</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td>isEmpty</td>
<td>Element for building SQL when property value is <tt class="docutils literal"><span class="pre">null</span></tt> or empty.
It can be specified for <tt class="docutils literal"><span class="pre">Collection</span></tt> and <tt class="docutils literal"><span class="pre">String</span></tt>.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="4">
<li></li>
</ol>
</td>
<td>isNotEmpty</td>
<td>Element for building SQL when property value is <tt class="docutils literal"><span class="pre">null</span></tt> and not empty.
It can be specified for <tt class="docutils literal"><span class="pre">Collection</span></tt> and <tt class="docutils literal"><span class="pre">String</span></tt>.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Implementation is as follows:</p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;findOne&quot;</span> <span class="na">parameterClass=</span><span class="s">&quot;OrderCriteria&quot;</span> <span class="na">resultMap=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>
    SELECT
        *
    FROM
        t_order
    WHERE

    <span class="nt">&lt;isNull</span> <span class="na">property=</span><span class="s">&quot;orderedDate&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
        <span class="cp">&lt;![CDATA[</span>
<span class="cp">        CURRENT_DATE - &#39;1 months&#39;::interval &lt;= ordered_date</span>
<span class="cp">        ]]&gt;</span>
    <span class="nt">&lt;/isNull&gt;</span>

    <span class="nt">&lt;isNotNull</span> <span class="na">property=</span><span class="s">&quot;orderedDate&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (2) --&gt;</span>
        ordered_date = #orderedDate#
    <span class="nt">&lt;/isNotNull&gt;</span>

    <span class="nt">&lt;isEmpty</span> <span class="na">property=</span><span class="s">&quot;statusCodes&quot;</span> <span class="na">prepend=</span><span class="s">&quot;AND&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (3) --&gt;</span>
        <span class="cp">&lt;![CDATA[</span>
<span class="cp">        status_code &lt;&gt; &#39;completed&#39;</span>
<span class="cp">        ]]&gt;</span>
    <span class="nt">&lt;/isEmpty&gt;</span>

    <span class="nt">&lt;isNotEmpty</span> <span class="na">property=</span><span class="s">&quot;statusCodes&quot;</span> <span class="na">prepend=</span><span class="s">&quot;AND&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (4) --&gt;</span>
        status_code IN
        <span class="nt">&lt;iterate</span> <span class="na">property=</span><span class="s">&quot;statusCodes&quot;</span> <span class="na">open=</span><span class="s">&quot;(&quot;</span> <span class="na">close=</span><span class="s">&quot;)&quot;</span> <span class="na">conjunction=</span><span class="s">&quot;,&quot;</span><span class="nt">&gt;</span>
            #statusCodes[]#
        <span class="nt">&lt;/iterate&gt;</span>
    <span class="nt">&lt;/isNotEmpty&gt;</span>

<span class="nt">&lt;/select&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">In the example, when <tt class="docutils literal"><span class="pre">orderedDate</span></tt> property (Date type) value is <tt class="docutils literal"><span class="pre">null</span></tt>, WHERE clause is set such that the ordered_date column can fetch records starting from one month prior to the current date.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">In the example, when <tt class="docutils literal"><span class="pre">orderedDate</span></tt> property (Date type) value is not <tt class="docutils literal"><span class="pre">null</span></tt>, WHERE clause is set such that the ordered_date column can fetch records that match with <tt class="docutils literal"><span class="pre">orderedDate</span></tt>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">In the example, when <tt class="docutils literal"><span class="pre">statusCodes</span></tt> property (List&lt;String&gt; type) value is empty, WHERE clause is set such that the status_code column can fetch records other than <tt class="docutils literal"><span class="pre">'completed'</span></tt>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">In the example, when <tt class="docutils literal"><span class="pre">statusCodes</span></tt> property (List&lt;String&gt; type) value is not empty, WHERE clause is set such that the status_code column can fetch records that match with any of the values stored in <tt class="docutils literal"><span class="pre">statusCodes</span></tt>.</div>
<div class="line">iterate element is described later.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Following 4 SQL patterns are generated by the dynamic SQL mentioned above.</p>
<blockquote>
<div><div class="highlight-sql"><div class="highlight"><pre><span class="c1">-- (1) orderedDate=null, statusCodes=[]</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">t_order</span> <span class="k">WHERE</span> <span class="k">CURRENT_DATE</span> <span class="o">-</span> <span class="s1">&#39;1 months&#39;</span><span class="p">::</span><span class="nb">interval</span> <span class="o">&lt;=</span> <span class="n">ordered_date</span>
    <span class="k">AND</span> <span class="n">status_code</span> <span class="o">&lt;&gt;</span> <span class="s1">&#39;completed&#39;</span>

<span class="c1">-- (2) orderedDate=null, statusCodes=[&#39;accepted&#39;,&#39;checking&#39;]</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">t_order</span> <span class="k">WHERE</span> <span class="k">CURRENT_DATE</span> <span class="o">-</span> <span class="s1">&#39;1 months&#39;</span><span class="p">::</span><span class="nb">interval</span> <span class="o">&lt;=</span> <span class="n">ordered_date</span>
    <span class="k">AND</span> <span class="n">status_code</span> <span class="k">IN</span> <span class="p">(</span><span class="s1">&#39;accepted&#39;</span><span class="p">,</span><span class="s1">&#39;checking&#39;</span><span class="p">)</span>

<span class="c1">-- (3) orderedDate=2013/12/31, statusCodes=null</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">t_order</span> <span class="k">WHERE</span> <span class="n">ordered_date</span> <span class="o">=</span> <span class="s1">&#39;2013/12/31&#39;</span>
    <span class="k">AND</span> <span class="n">status_code</span> <span class="o">&lt;&gt;</span> <span class="s1">&#39;completed&#39;</span>

<span class="c1">-- (4) orderedDate=2013/12/31, statusCodes=[&#39;accepted&#39;]</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">t_order</span> <span class="k">WHERE</span> <span class="n">ordered_date</span> <span class="o">=</span> <span class="s1">&#39;2013/12/31&#39;</span>
    <span class="k">AND</span> <span class="n">status_code</span> <span class="k">IN</span> <span class="p">(</span><span class="s1">&#39;accepted&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="determining-the-property-value-of-parameter-object-javabean">
<h4><a class="toc-backref" href="#id25">5.4.2.4.4. Determining the property value of parameter object (JavaBean)</a><a class="headerlink" href="#determining-the-property-value-of-parameter-object-javabean" title="Permalink to this headline">¶</a></h4>
<p>SQL can be built by determining the value specified in the property of parameter object (JavaBean) passed to SQL.</p>
<p>Decision elements are as follows:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="15%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Element</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>isEqual</td>
<td>Element for building SQL when property value matches with the specified value.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td>isNotEqual</td>
<td>Element for building SQL when property value does not match with the specified value.</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td>isGreaterThan</td>
<td>Element for building SQL when property value is greater than the specified value.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="4">
<li></li>
</ol>
</td>
<td>isGreaterEqual</td>
<td>Element for building SQL when property value is greater than or equal to the specified value.</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="5">
<li></li>
</ol>
</td>
<td>isLessThan</td>
<td>Element for building SQL when property value is less than the specified value.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="6">
<li></li>
</ol>
</td>
<td>isLessEqual</td>
<td>Element for building SQL when property value is less than or equal to the specified value.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Implementation is as follows:</p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;findOne&quot;</span> <span class="na">parameterClass=</span><span class="s">&quot;OrderCriteria&quot;</span> <span class="na">resultMap=</span><span class="s">&quot;...&quot;</span><span class="nt">&gt;</span>
    SELECT
        *
    FROM
        t_order
    WHERE
        (
        <span class="cp">&lt;![CDATA[</span>
<span class="cp">        status_code &lt;&gt; &#39;completed&#39;</span>
<span class="cp">        ]]&gt;</span>
        <span class="nt">&lt;isEqual</span> <span class="na">property=</span><span class="s">&quot;containCompletedOrder&quot;</span>
                 <span class="na">compareValue=</span><span class="s">&quot;true&quot;</span>
                 <span class="na">prepend=</span><span class="s">&quot;OR&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
            status_code = &#39;completed&#39;
        <span class="nt">&lt;/isNull&gt;</span>
        )

<span class="nt">&lt;/select&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">In the example, when the <tt class="docutils literal"><span class="pre">containCompletedOrder</span></tt> property (Boolean type) value is <tt class="docutils literal"><span class="pre">true</span></tt>, WHERE clause is set such that the status_code column fetches <tt class="docutils literal"><span class="pre">'completed'</span></tt> records as well.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Other property values in JavaBean can be compared by using compareProperty attribute.</p>
</div>
</div></blockquote>
<p>Following 2 SQL patterns are generated by the dynamic SQL mentioned above.</p>
<blockquote>
<div><div class="highlight-sql"><div class="highlight"><pre><span class="c1">-- (1) containCompletedOrder=false</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">t_order</span> <span class="k">WHERE</span> <span class="p">(</span><span class="n">status_code</span> <span class="o">&lt;&gt;</span>  <span class="s1">&#39;completed&#39;</span><span class="p">)</span>

<span class="c1">-- (2) containCompletedOrder=true</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">t_order</span> <span class="k">WHERE</span> <span class="p">(</span><span class="n">status_code</span> <span class="o">&lt;&gt;</span>  <span class="s1">&#39;completed&#39;</span> <span class="k">OR</span> <span class="n">status_code</span> <span class="o">=</span> <span class="s1">&#39;completed&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="common-attributes-of-decision-elements">
<h4><a class="toc-backref" href="#id26">5.4.2.4.5. Common attributes of decision elements</a><a class="headerlink" href="#common-attributes-of-decision-elements" title="Permalink to this headline">¶</a></h4>
<p>Elements that build dynamic SQL have the following common attributes.</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="15%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Attribute</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>prepend</td>
<td>When the SQL statement is determined as <tt class="docutils literal"><span class="pre">true</span></tt> by the decision element used for building dynamic SQL, specify the character string set at the beginning of the SQL.</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td>open</td>
<td>Specify the character string to be added before the built SQL in the decision element used for building dynamic SQL.</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td>close</td>
<td>Specify the character string to be added at the end of the built SQL in the decision element used for building dynamic SQL.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Implementation is as follows:</p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;findOne&quot;</span> <span class="na">parameterClass=</span><span class="s">&quot;OrderCriteria&quot;</span> <span class="na">resultMap=</span><span class="s">&quot;...&quot;</span><span class="nt">&gt;</span>
    SELECT
        *
    FROM
        t_order

    <span class="nt">&lt;isNotEmpty</span> <span class="na">property=</span><span class="s">&quot;statusCode&quot;</span>
                <span class="na">prepend=</span><span class="s">&quot;WHERE&quot;</span>
                <span class="na">open=</span><span class="s">&quot;(&quot;</span>
                <span class="na">close=</span><span class="s">&quot;)&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
        status_code = #statusCode#
        <span class="nt">&lt;isEqual</span> <span class="na">property=</span><span class="s">&quot;containCompletedOrder&quot;</span> <span class="na">compareValue=</span><span class="s">&quot;true&quot;</span> <span class="na">prepend=</span><span class="s">&quot;OR&quot;</span><span class="nt">&gt;</span>
            status_code = &#39;completed&#39;
        <span class="nt">&lt;/isEqual&gt;</span>
    <span class="nt">&lt;/isNotEmpty&gt;</span>

<span class="nt">&lt;/select&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="15%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Attribute</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">-</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">In the example, when a value is specified in <tt class="docutils literal"><span class="pre">statusCode</span></tt> property, on setting the WHERE clause in status_code column, if the</div>
<div class="line"><tt class="docutils literal"><span class="pre">containCompletedOrder</span></tt> property (Boolean type) value is <tt class="docutils literal"><span class="pre">true</span></tt>, WHERE clause is set such that status_code column fetches <tt class="docutils literal"><span class="pre">'completed'</span></tt> records as well.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">-</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">prepend</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><tt class="docutils literal"><span class="pre">&quot;WHERE&quot;</span></tt> clause is set in SQL when value is specified in <tt class="docutils literal"><span class="pre">statusCode</span></tt> property.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">-</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">open</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">When the <tt class="docutils literal"><span class="pre">containCompletedOrder</span></tt> property (Boolean type) value is <tt class="docutils literal"><span class="pre">true</span></tt>,</div>
<div class="line">opening character <tt class="docutils literal"><span class="pre">&quot;(&quot;</span></tt>, used for grouping the conditions for status_code column is specified, so as to add the OR condition.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">-</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">close</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Closing character  <tt class="docutils literal"><span class="pre">&quot;)&quot;</span></tt> used for grouping the conditions for status_code column is specified.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Following 3 SQL patterns are generated by dynamic SQL mentioned above.</p>
<blockquote>
<div><div class="highlight-sql"><div class="highlight"><pre><span class="c1">-- (1) statusCode=null, containCompletedOrder=false</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">t_order</span>

<span class="c1">-- (2) statusCode=&#39;accepted&#39;, containCompletedOrder=false</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">t_order</span> <span class="k">WHERE</span> <span class="p">(</span><span class="n">status_code</span> <span class="o">=</span> <span class="s1">&#39;accepted&#39;</span><span class="p">)</span>

<span class="c1">-- (3) statusCode=&#39;checking&#39;, containCompletedOrder=true</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">t_order</span> <span class="k">WHERE</span> <span class="p">(</span><span class="n">status_code</span> <span class="o">=</span> <span class="s1">&#39;checking&#39;</span> <span class="k">OR</span> <span class="n">status_code</span> <span class="o">=</span> <span class="s1">&#39;completed&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="collection-iteration">
<h4><a class="toc-backref" href="#id27">5.4.2.4.6. Collection iteration</a><a class="headerlink" href="#collection-iteration" title="Permalink to this headline">¶</a></h4>
<p>When a collection or array of bind values is passed to SQL, the SQL can be built by iterating the process for element part of the collection and array.</p>
<p>Element is as follows:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="15%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Element</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>iterate</td>
<td>Element that builds SQL by carrying out iteration process for collection and array.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Implementation is as follows:</p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;findOne&quot;</span> <span class="na">parameterClass=</span><span class="s">&quot;OrderCriteria&quot;</span> <span class="na">resultMap=</span><span class="s">&quot;...&quot;</span><span class="nt">&gt;</span>
    SELECT
        *
    FROM
        t_order

    <span class="nt">&lt;isNotNull</span> <span class="na">property=</span><span class="s">&quot;statusCodes&quot;</span> <span class="na">prepend=</span><span class="s">&quot;WHERE&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;iterate</span> <span class="na">property=</span><span class="s">&quot;statusCodes&quot;</span>
                 <span class="na">prepend=</span><span class="s">&quot;status_code IN&quot;</span>
                 <span class="na">open=</span><span class="s">&quot;(&quot;</span>
                 <span class="na">conjunction=</span><span class="s">&quot;,&quot;</span>
                 <span class="na">close=</span><span class="s">&quot;)&quot;</span> <span class="nt">&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
            #statusCodes[]#
        <span class="nt">&lt;/iterate&gt;</span>
    <span class="nt">&lt;/isNotNull&gt;</span>

<span class="nt">&lt;/select&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="15%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Attribute</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">-</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">In the example,  value stored in <tt class="docutils literal"><span class="pre">statusCodes</span></tt> property (List&lt;String&gt;) is set as a value for IN clause.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">-</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">prepend</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">When collection or array elements exist, specify the character string to be set first. In the example, the column name to be added to the condition as well as IN clause are specified.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">-</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">open</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the character string to be set before processing the first element of collection or array. In the example, the starting enclosure character <tt class="docutils literal"><span class="pre">&quot;(&quot;</span></tt> of the value specified in IN clause is specified.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">-</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">conjunction</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">If next element exists, specify the character string to be set before processing the next element. In the example, delimiter <tt class="docutils literal"><span class="pre">&quot;,&quot;</span></tt> of the value specified in IN clause is specified.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">-</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">close</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the character string to be set after processing the last element of collection or array. In the example, ending enclosure character <tt class="docutils literal"><span class="pre">&quot;)&quot;</span></tt> of the value specified in IN clause is specified.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The above example illustrates the implementation wherein the JavaBean properties are of collection type. However, the parameter objects themselves can be set to collection type.
In that case, it can be accessed in <tt class="docutils literal"><span class="pre">#[]#</span></tt> format without specifying the property attribute.</p>
<p class="last">JavaBean can also be stored in collection and JavaBean nested collection can also be accessed.
For details, refer to &#8220;Dynamic Mapped Statements&#8221; (P.52) of the Developer Guide (PDF).</p>
</div>
</div></blockquote>
<p>Following 3 SQL patterns are generated by the dynamic SQL mentioned above.</p>
<blockquote>
<div><div class="highlight-sql"><div class="highlight"><pre><span class="c1">-- (1) statusCodes=null</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">t_order</span>

<span class="c1">-- (2) statusCodes=[]</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">t_order</span>

<span class="c1">-- (3) statusCodes=[&#39;accepted&#39;,&#39;checking&#39;]</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">t_order</span> <span class="k">WHERE</span> <span class="n">status_code</span> <span class="k">IN</span> <span class="p">(</span><span class="s1">&#39;accepted&#39;</span> <span class="p">,</span> <span class="s1">&#39;checking&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="dynamic-sql-blocking">
<h4><a class="toc-backref" href="#id28">5.4.2.4.7. Dynamic SQL blocking</a><a class="headerlink" href="#dynamic-sql-blocking" title="Permalink to this headline">¶</a></h4>
<p>By blocking individual dynamic SQL, prepend, open and close attributes can be controlled as an entire block.</p>
<p>The elements are as follows:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="15%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Element</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>dynamic</td>
<td>Element that blocks the elements building the dynamic SQL.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Implementation is as follows:</p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;findOne&quot;</span> <span class="na">parameterClass=</span><span class="s">&quot;OrderCriteria&quot;</span> <span class="na">resultMap=</span><span class="s">&quot;...&quot;</span><span class="nt">&gt;</span>
    SELECT
        *
    FROM
        t_order
    WHERE

    <span class="nt">&lt;dynamic</span> <span class="na">prepend=</span><span class="s">&quot;WHERE&quot;</span>
             <span class="na">open=</span><span class="s">&quot;(&quot;</span>
             <span class="na">close=</span><span class="s">&quot;)&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>

        <span class="nt">&lt;isNotEmpty</span> <span class="na">property=</span><span class="s">&quot;id&quot;</span> <span class="na">prepend=</span><span class="s">&quot;AND&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (2) --&gt;</span>
            id = #id#
        <span class="nt">&lt;/isNotEmpty&gt;</span>

        <span class="nt">&lt;isNotEmpty</span> <span class="na">property=</span><span class="s">&quot;statusCode&quot;</span> <span class="na">prepend=</span><span class="s">&quot;AND&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (3) --&gt;</span>
            status_code = #statusCode#
        <span class="nt">&lt;/isNotEmpty&gt;</span>

    <span class="nt">&lt;/dynamic&gt;</span>

<span class="nt">&lt;/select&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="15%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Attribute</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">-</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Dynamic SQLs of (2) and (3) are blocked.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">-</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">prepend</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the character string to be prepended to the SQL built within the block. Value specified here is used as the prepend attribute value of the dynamic SQL matched in the block at first.</div>
<div class="line">In the above example, when value is specified in the <tt class="docutils literal"><span class="pre">id</span></tt> property, the value of prepend attribute in (2) becomes  <tt class="docutils literal"><span class="pre">&quot;WHERE&quot;</span></tt> rather than <tt class="docutils literal"><span class="pre">&quot;AND&quot;</span></tt>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">-</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">open</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the character string to be added before the SQL built in block.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">-</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">close</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the character string to be added after the SQL built in block.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Following 4 SQL patterns are generated by the dynamic SQL mentioned above.</p>
<blockquote>
<div><div class="highlight-sql"><div class="highlight"><pre><span class="c1">-- (1) id=null, statusCode=null</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">t_order</span>

<span class="c1">-- (2) id=1, statusCode=null</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">t_order</span> <span class="k">WHERE</span> <span class="p">(</span><span class="n">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1">-- (3) id=null, statusCode=&#39;accepted&#39;</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">t_order</span> <span class="k">WHERE</span> <span class="p">(</span><span class="n">status_code</span> <span class="o">=</span> <span class="s1">&#39;accepted&#39;</span><span class="p">)</span>

<span class="c1">-- (4) id=1, statusCode=&#39;accepted&#39;</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">t_order</span> <span class="k">WHERE</span> <span class="p">(</span><span class="n">id</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">AND</span> <span class="n">status_code</span> <span class="o">=</span> <span class="s1">&#39;accepted&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="how-to-use-querydao">
<h3><a class="toc-backref" href="#id29">5.4.2.5. How to use QueryDAO</a><a class="headerlink" href="#how-to-use-querydao" title="Permalink to this headline">¶</a></h3>
<div class="section" id="single-record-search">
<h4><a class="toc-backref" href="#id30">5.4.2.5.1. Single record search</a><a class="headerlink" href="#single-record-search" title="Permalink to this headline">¶</a></h4>
<p>Implementation is as follows when a query with search results as 0 to 1 record is issued.</p>
<ul class="simple">
<li>Xxx.java</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="n">String</span> <span class="n">todoId</span> <span class="o">=</span> <span class="s">&quot;xxxxx....&quot;</span><span class="o">;</span>
<span class="n">Todo</span> <span class="n">loadedTodo</span> <span class="o">=</span> <span class="n">queryDAO</span><span class="o">.</span><span class="na">executeForObject</span><span class="o">(</span> <span class="c1">// (1)</span>
        <span class="s">&quot;todo.findOne&quot;</span><span class="o">,</span>    <span class="c1">// (2)</span>
        <span class="n">todoId</span><span class="o">,</span>            <span class="c1">// (3)</span>
        <span class="n">Todo</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>       <span class="c1">// (4)</span>
<span class="k">if</span> <span class="o">(</span><span class="n">loadedTodo</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>  <span class="c1">// (5)</span>
    <span class="c1">// ...                 // (6)</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>Call the method (<tt class="docutils literal"><span class="pre">QueryDAO#executeForObject</span></tt>) that fetches search result as the object of type specified in (4).</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify SQLID of the SQL with search result 0 to 1 record.</div>
<div class="line">Mybatis throws <tt class="docutils literal"><span class="pre">java.sql.SQLException</span></tt> when the search results are more than one.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify SQL bind parameter.</div>
<div class="line">In the example, bind parameter is <tt class="docutils literal"><span class="pre">java.lang.String</span></tt>. However, when multiple parameters (search conditions) are to be passed, JavaBean can also be specified.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td>Specify the type of object that maps the fetch results of SQL.</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td>When the search result shows 0 records, the value becomes null. Hence, null check is necessary.</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td>Implement the process when search result is 0 records.</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="multiple-records-search">
<h4><a class="toc-backref" href="#id31">5.4.2.5.2. Multiple records search</a><a class="headerlink" href="#multiple-records-search" title="Permalink to this headline">¶</a></h4>
<p>Implementation is as follows when query with search result 0 to N records is issued and all the data matching with the conditions is fetched.</p>
<ul class="simple">
<li>Xxx.java</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="kt">boolean</span> <span class="n">finished</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span> <span class="n">unfinishedTodoList</span> <span class="o">=</span> <span class="n">queryDAO</span><span class="o">.</span><span class="na">executeForObjectList</span><span class="o">(</span> <span class="c1">// (1)</span>
        <span class="s">&quot;todo.findByFinished&quot;</span><span class="o">,</span>     <span class="c1">// (2)</span>
        <span class="n">finished</span><span class="o">);</span>                 <span class="c1">// (3)</span>
<span class="k">if</span><span class="o">(</span><span class="n">unfinishedTodoList</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">()){</span>  <span class="c1">// (4)</span>
    <span class="c1">// ...                         // (5)</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>Call the method to fetch the objects list.</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td>Specify SQLID of the SQL with search result 0 to N records.</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the SQL bind parameter.</div>
<div class="line">In the example, bind parameter is set as boolean. However, when multiple parameters (search conditions) are to be passed, JavaBean can also be specified.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td>When search result is 0 records, an empty list is returned. null check is not required as null value is not returned.</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td>Implement the process when search result is 0 records.</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="pagination-search-terasoluna-dao-standard-function-system">
<h4><a class="toc-backref" href="#id32">5.4.2.5.3. Pagination search (TERASOLUNA DAO standard function system)</a><a class="headerlink" href="#pagination-search-terasoluna-dao-standard-function-system" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">When issuing a query with search result 0 to N records and fetching a part of data (specified part of page) matching with the condition, the implementation is as follows:</div>
<div class="line">Following implementation is done by using the API provided by TERASOLUNA DAO.</div>
</div>
<dl class="docutils">
<dt></dt>
<dd><div class="first last admonition warning">
<p class="first admonition-title">Warning</p>
<p><strong>Points to be noted when an extremely large number of data records match with search conditions</strong></p>
<p class="last">In the TERASOLUNA DAO standard function pagination search, the part up to starting position of the records that are fetched using <tt class="docutils literal"><span class="pre">java.sql.ResultSet#next</span></tt> is skipped.
As a result, when the number of data records matching with search conditions is huge, it may impact the process performance.
When there is a possibility of a huge number of data records matching the search conditions, SQL refinement should be adopted instead of pagination search of TERASOLUNA DAO standard function.</p>
</div>
</dd>
</dl>
<ul class="simple">
<li>Xxx.java</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="n">Pageable</span> <span class="n">pageable</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PageRequest</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">10</span><span class="o">);</span> <span class="c1">// (1)</span>
<span class="kt">boolean</span> <span class="n">finished</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
<span class="kt">long</span> <span class="n">totalCount</span> <span class="o">=</span> <span class="n">queryDAO</span><span class="o">.</span><span class="na">executeForObject</span><span class="o">(</span>
        <span class="s">&quot;todo.countByFinished&quot;</span><span class="o">,</span> <span class="c1">// (2)</span>
        <span class="n">finished</span><span class="o">,</span>
        <span class="n">Long</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>            <span class="c1">// (3)</span>

<span class="n">List</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span> <span class="n">unfinishedTodoList</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="k">if</span><span class="o">(</span><span class="mi">0</span> <span class="o">&lt;</span> <span class="n">totalCount</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">unfinishedTodoList</span> <span class="o">=</span> <span class="n">queryDAO</span><span class="o">.</span><span class="na">executeForObjectList</span><span class="o">(</span>
        <span class="s">&quot;todo.findByFinished&quot;</span><span class="o">,</span>   <span class="c1">// (4)</span>
        <span class="n">finished</span><span class="o">,</span>
        <span class="n">pageable</span><span class="o">.</span><span class="na">getOffset</span><span class="o">(),</span>    <span class="c1">// (5)</span>
        <span class="n">pageable</span><span class="o">.</span><span class="na">getPageSize</span><span class="o">());</span> <span class="c1">// (6)</span>
<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="n">unfinishedTodoList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;();</span>
<span class="o">}</span>

<span class="n">Page</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span> <span class="n">page</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PageImpl</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;(</span> <span class="c1">// (7)</span>
        <span class="n">unfinishedTodoList</span><span class="o">,</span> <span class="c1">// (8)</span>
        <span class="n">pageable</span><span class="o">,</span>           <span class="c1">// (9)</span>
        <span class="n">totalCount</span><span class="o">);</span>        <span class="c1">// (10)</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>xxx-sqlmap.xml</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;findByFinished&quot;</span>
        <span class="na">parameterClass=</span><span class="s">&quot;boolean&quot;</span>
        <span class="na">resultMap=</span><span class="s">&quot;resultMap_Todo&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (11) --&gt;</span>
    SELECT
        *
    FROM
        todo
    WHERE
        finished = #finished#
    ORDER BY
        created_at DESC
<span class="nt">&lt;/select&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>Generate paging search object (<tt class="docutils literal"><span class="pre">org.springframework.data.domain.PageRequest</span></tt>) provided by Spring Data.
Pageable object can also be received as Controller argument by specifying in request parameters. For details, refer to <a class="reference internal" href="Pagination.html"><em>Pagination</em></a>.</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td>Execute by specifying the SQLID of the SQL that fetches total number of data records matching with the condition.</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td>Specify Long.class since this involves fetching records.</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td>Execute by specifying the SQLID of the SQL with search result 0 to N records.</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the start position from where records are to be fetched.</div>
<div class="line">Starting from 0. When 10 records are to be fetched, on specifying 10, records from 11 to 20th are fetched.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the number of records to be fetched.</div>
<div class="line">When the start position for fetching records is 0, on specifying 10, records from 1 to 10th are fetched.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td>Generate the page object (<tt class="docutils literal"><span class="pre">org.springframework.data.domain.PageImpl</span></tt>) provided by Spring Data.</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(8)</div>
</div>
</td>
<td>Carry out pagination search and specify the fetched list.</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(9)</div>
</div>
</td>
<td>Specify the paging search object (Pageable) used in pagination search.</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(10)</div>
</div>
</td>
<td>Specify the total number of data records that match with the condition.</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(11)</div>
</div>
</td>
<td>SQL implementation. It is not necessary to consider the fetch position in case of SQL.</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="pagination-search-sql-refinement">
<h4><a class="toc-backref" href="#id33">5.4.2.5.4. Pagination search (SQL refinement)</a><a class="headerlink" href="#pagination-search-sql-refinement" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">When a query with search result 0 to N records is issued and a part of data (specified part of page) matching with the condition is fetched, the implementation is as follows:</div>
<div class="line">Following implementation is done by using SQL instead of the API provided by TERASOLUNA DAO.</div>
</div>
<ul class="simple">
<li>PageableBindParams.java (Sample class)</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">PageableBindParams</span><span class="o">&lt;</span><span class="n">P</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span> <span class="c1">// (1)</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">P</span> <span class="n">bindParams</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Pageable</span> <span class="n">pageable</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">PageableBindParams</span><span class="o">(</span><span class="n">P</span> <span class="n">bindParams</span><span class="o">,</span> <span class="n">Pageable</span> <span class="n">pageable</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">bindParams</span> <span class="o">=</span> <span class="n">bindParams</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">pageable</span> <span class="o">=</span> <span class="n">pageable</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">P</span> <span class="nf">getBindParams</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">bindParams</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">Pageable</span> <span class="nf">getPageable</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">pageable</span><span class="o">;</span>
    <span class="o">}</span>
 <span class="o">}</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>Xxx.java</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="n">Pageable</span> <span class="n">pageable</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PageRequest</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">10</span><span class="o">);</span>
<span class="kt">boolean</span> <span class="n">finished</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
<span class="kt">long</span> <span class="n">totalCount</span> <span class="o">=</span> <span class="n">queryDAO</span><span class="o">.</span><span class="na">executeForObject</span><span class="o">(</span>
        <span class="s">&quot;todo.countByFinished&quot;</span><span class="o">,</span>
        <span class="n">finished</span><span class="o">,</span>
        <span class="n">Long</span><span class="o">.</span><span class="na">class</span><span class="o">);</span> <span class="c1">// (2)</span>

<span class="n">List</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span> <span class="n">unfinishedTodoList</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="k">if</span><span class="o">(</span><span class="mi">0</span> <span class="o">&lt;</span> <span class="n">totalCount</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">PageableBindParams</span><span class="o">&lt;</span><span class="n">Boolean</span><span class="o">&gt;</span> <span class="n">pageableBindParams</span> <span class="o">=</span>
            <span class="k">new</span> <span class="n">PageableBindParams</span><span class="o">&lt;</span><span class="n">Boolean</span><span class="o">&gt;(</span> <span class="c1">// (3)</span>
                     <span class="n">finished</span><span class="o">,</span>  <span class="c1">// (4)</span>
                    <span class="n">pageable</span><span class="o">);</span> <span class="c1">// (5)</span>
    <span class="n">unfinishedTodoList</span> <span class="o">=</span> <span class="n">queryDAO</span><span class="o">.</span><span class="na">executeForObjectList</span><span class="o">(</span>
            <span class="s">&quot;todo.findPageByFinished&quot;</span><span class="o">,</span> <span class="c1">// (6)</span>
            <span class="n">pageableBindParams</span><span class="o">);</span>       <span class="c1">// (7)</span>
<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="n">unfinishedTodoList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;();</span>
<span class="o">}</span>

<span class="n">Page</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span> <span class="n">page</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PageImpl</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;(</span>
        <span class="n">unfinishedTodoList</span><span class="o">,</span>
        <span class="n">pageable</span><span class="o">,</span>
        <span class="n">totalCount</span><span class="o">);</span> <span class="c1">// (8)</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>xxx-sqlmap.xml</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre> <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;findPageByFinished&quot;</span>
         <span class="na">parameterClass=</span><span class="s">&quot;xxxxxx.yyyyyy.zzzzzz.domain.dto.PageableBindParams&quot;</span>
         <span class="na">resultMap=</span><span class="s">&quot;resultMap_Todo&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (9) --&gt;</span>
     SELECT
         *
     FROM
         todo
     WHERE
         finished = #bindParams#
     ORDER BY
         created_at DESC
     OFFSET
         #pageable.offset#    /* (10) */
     LIMIT
         #pageable.pageSize#  /* (11) */
<span class="nt">&lt;/select&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>JavaBean storing the parameters (bind parameter) that form search conditions and paging search object provided by Spring Data (<tt class="docutils literal"><span class="pre">org.springframework.data.domain.Pageable</span></tt>).
An aggregate object like this class is necessary since only a single object can be passed to DAO. This class should be provided as required in each project since it is a sample implementation.</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td>Fetch the total number of records similar to using TERASOLUNA DAO standard function.</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Generate the bind object to be passed to DAO.</div>
<div class="line">In the example, class provided in (1) is used.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the search condition to narrow down target data.</div>
<div class="line">In the example, &#8220;false&#8221; is specified as the value of &#8220;finished&#8221;.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the search condition for narrowing down data on the corresponding page.</div>
<div class="line">In the example, paging search object provided by Spring Data (<tt class="docutils literal"><span class="pre">org.springframework.data.domain.PageRequest</span></tt>) is specified.</div>
<div class="line">The Pageable object can also be received as Controller argument by specifying it in request parameters. For details, refer to <a class="reference internal" href="Pagination.html"><em>Pagination</em></a>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td>Specify SQLID of the SQL executed by the SQL that extracts data on the corresponding page.</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td>Specify the bind object generated in (3).</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(8)</div>
</div>
</td>
<td>Same as using TERASOLUNA DAO standard function, generate the page object provided by Spring Data (<tt class="docutils literal"><span class="pre">org.springframework.data.domain.PageImpl</span></tt>).</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(9)</div>
</div>
</td>
<td>SQL implementation. In the example, PostgreSQL function (OFFSET, LIMIT) are used. As an SQL, notice the fetch position.</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(10)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the start position from where records are to be fetched.</div>
<div class="line">Starting from 0. When 10 records are to be fetched, on specifying 10, records from 11 to 20th are fetched. (Use PostgreSQL function).</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(11)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the number of records to be fetched.</div>
<div class="line">When the start position for fetching records is 0, on specifying 10, records from 1 to 10th are fetched. (Use PostgreSQL function).</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
</div>
<div class="section" id="how-to-use-updatedao">
<h3><a class="toc-backref" href="#id34">5.4.2.6. How to use UpdateDAO</a><a class="headerlink" href="#how-to-use-updatedao" title="Permalink to this headline">¶</a></h3>
<div class="section" id="inserting-a-single-record">
<h4><a class="toc-backref" href="#id35">5.4.2.6.1. Inserting a single record</a><a class="headerlink" href="#inserting-a-single-record" title="Permalink to this headline">¶</a></h4>
<p>The implementation is as follows when a single data record is to be inserted.</p>
<ul class="simple">
<li>Xxx.java</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="c1">// (1)</span>
<span class="n">Todo</span> <span class="n">todo</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Todo</span><span class="o">();</span>
<span class="n">todo</span><span class="o">.</span><span class="na">setTodoId</span><span class="o">(</span><span class="n">todoId</span><span class="o">);</span>
<span class="n">todo</span><span class="o">.</span><span class="na">setTodoTitle</span><span class="o">(</span><span class="n">todoTitle</span><span class="o">);</span>
<span class="n">todo</span><span class="o">.</span><span class="na">setFinished</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
<span class="n">todo</span><span class="o">.</span><span class="na">setCreatedAt</span><span class="o">(</span><span class="n">now</span><span class="o">);</span>
<span class="kt">int</span> <span class="n">insertedCount</span> <span class="o">=</span> <span class="n">updateDAO</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="s">&quot;todo.insert&quot;</span><span class="o">,</span> <span class="n">todo</span><span class="o">);</span> <span class="c1">// (2)</span>
<span class="k">if</span><span class="o">(</span><span class="n">insertedCount</span> <span class="o">!=</span> <span class="mi">1</span><span class="o">){</span>  <span class="c1">// (3)</span>
    <span class="c1">// ...               // (4)</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>Generate the data to be inserted (JavaBean).</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td>Execute DAO by specifying SQLID of Insert SQL and the data to be inserted (JavaBean).</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td>If required, check the number of data records actually inserted. In the example, it is checked whether a single record is inserted.</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td>If required, carry out the process when the number of actually inserted records differs from number of expected records.</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="inserting-multiple-records-batch-execution">
<h4><a class="toc-backref" href="#id36">5.4.2.6.2. Inserting multiple records (batch execution)</a><a class="headerlink" href="#inserting-multiple-records-batch-execution" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">Implementation in case of inserting multiple data records through batch execution of multiple SQLs is as follows:</div>
<div class="line">Use <tt class="docutils literal"><span class="pre">jp.terasoluna.fw.dao.SqlHolder</span></tt> provided by TERASOLUNA DAO.</div>
</div>
<ul class="simple">
<li>Xxx.java</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="c1">// (1)</span>
<span class="n">Todo</span> <span class="n">todo</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Todo</span><span class="o">();</span>
<span class="n">todo</span><span class="o">.</span><span class="na">setTodoId</span><span class="o">(</span><span class="n">todoId</span><span class="o">);</span>
<span class="n">todo</span><span class="o">.</span><span class="na">setTodoTitle</span><span class="o">(</span><span class="n">todoTitle</span><span class="o">);</span>
<span class="n">todo</span><span class="o">.</span><span class="na">setFinished</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
<span class="n">todo</span><span class="o">.</span><span class="na">setCreatedAt</span><span class="o">(</span><span class="n">now</span><span class="o">);</span>

<span class="c1">// (2)</span>
<span class="n">Todo</span> <span class="n">todo2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Todo</span><span class="o">();</span>
<span class="n">todo2</span><span class="o">.</span><span class="na">setTodoId</span><span class="o">(</span><span class="n">todoId2</span><span class="o">);</span>
<span class="n">todo2</span><span class="o">.</span><span class="na">setTodoTitle</span><span class="o">(</span><span class="n">todoTitle2</span><span class="o">);</span>
<span class="n">todo2</span><span class="o">.</span><span class="na">setFinished</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
<span class="n">todo2</span><span class="o">.</span><span class="na">setCreatedAt</span><span class="o">(</span><span class="n">now</span><span class="o">);</span>

<span class="n">List</span><span class="o">&lt;</span><span class="n">SqlHolder</span><span class="o">&gt;</span> <span class="n">sqlHolders</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">SqlHolder</span><span class="o">&gt;();</span> <span class="c1">// (3)</span>
<span class="n">sqlHolders</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">SqlHolder</span><span class="o">(</span><span class="s">&quot;todo.insert&quot;</span><span class="o">,</span> <span class="n">todo</span><span class="o">));</span>      <span class="c1">// (4)</span>
<span class="n">sqlHolders</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">SqlHolder</span><span class="o">(</span><span class="s">&quot;todo.insert&quot;</span><span class="o">,</span> <span class="n">todo2</span><span class="o">));</span>     <span class="c1">// (4)</span>
<span class="kt">int</span> <span class="n">insertedCount</span> <span class="o">=</span> <span class="n">updateDAO</span><span class="o">.</span><span class="na">executeBatch</span><span class="o">(</span><span class="n">sqlHolders</span><span class="o">);</span>  <span class="c1">// (5)</span>
<span class="k">if</span><span class="o">(</span><span class="n">insertedCount</span> <span class="o">!=</span> <span class="mi">2</span><span class="o">){</span>  <span class="c1">// (6)</span>
    <span class="c1">// ...               // (7)</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>Generate the data to be inserted (JavaBean). 1st data record.</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td>Generate the data to be inserted (JavaBean). 2nd data record.</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td>Generate a list of <tt class="docutils literal"><span class="pre">jp.terasoluna.fw.dao.SqlHolder</span></tt> provided by TERASOLUNA DAO, for batch execution.</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td>Add the data generated in (1), (2) to the SqlHolder list as bind objects. In the example, 2 records are added to the list.</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td>Execute batch by specifying the SqlHolder list generated in (1)~(4).</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">If required, check the number of actually inserted data records.</div>
<div class="line">In the example, it is checked whether 2 records are inserted.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td>If required, carry out the process when the number of actually inserted records differs from the number of expected records.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<dl class="docutils">
<dt></dt>
<dd><div class="first last admonition warning">
<p class="first admonition-title">Warning</p>
<p><strong>About number of records inserted in batch execution</strong></p>
<p class="last">There are cases where, on batch execution, exact number of rows cannot be fetched using JDBC driver.
When a driver that is unable to fetch the exact number of rows is used, batch execution should not be carried out for the cases wherein number of inserted records need to be checked.
(This holds true for updated records and deleted records as well).</p>
</div>
</dd>
</dl>
</div>
<div class="section" id="updating-a-single-record">
<h4><a class="toc-backref" href="#id37">5.4.2.6.3. Updating a single record</a><a class="headerlink" href="#updating-a-single-record" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">Implementation is as follows while updating a single data record.</div>
<div class="line">It is the same as in case of inserting a single record. SQL to be used is Update SQL.</div>
</div>
<ul class="simple">
<li>Xxx.java</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="n">Todo</span> <span class="n">loadedTodo</span> <span class="o">=</span> <span class="n">queryDAO</span><span class="o">.</span><span class="na">executeForObject</span><span class="o">(</span><span class="s">&quot;todo.findOne&quot;</span><span class="o">,</span>
        <span class="n">todoId</span><span class="o">,</span>
        <span class="n">Todo</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>     <span class="c1">// (1)</span>
<span class="n">todo2</span><span class="o">.</span><span class="na">setFinished</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span> <span class="c1">// (2)</span>
<span class="kt">int</span> <span class="n">updatedCount</span> <span class="o">=</span> <span class="n">updateDAO</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="s">&quot;todo.update&quot;</span><span class="o">,</span> <span class="n">todo</span><span class="o">);</span> <span class="c1">// (3)</span>
<span class="k">if</span><span class="o">(</span><span class="n">updatedCount</span> <span class="o">!=</span> <span class="mi">1</span><span class="o">){</span>   <span class="c1">// (4)</span>
    <span class="c1">// ...               // (5)</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>Search the data to be updated (JavaBean).</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td>Update data. In the example, &#8220;finished&#8221; is updated from false to true.</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td>Execute DAO by specifying SQLID of the Update SQL and the data to be updated (JavaBean).</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">If required, check the number of actually updated data records.</div>
<div class="line">In the example, it is checked whether a single record is updated.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td>If required, carry out the process when the number of actually updated records differs from the number of expected records.</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="updating-multiple-records-batch-execution">
<h4><a class="toc-backref" href="#id38">5.4.2.6.4. Updating multiple records (batch execution)</a><a class="headerlink" href="#updating-multiple-records-batch-execution" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">Implementation for updating multiple data records through batch execution is same as in case of inserting multiple records (batch execution).</div>
<div class="line">Updating multiple records by batch execution is effective when the update value differs for each record.</div>
</div>
</div>
<div class="section" id="updating-multiple-records-specifying-where-clause">
<h4><a class="toc-backref" href="#id39">5.4.2.6.5. Updating multiple records (Specifying WHERE clause)</a><a class="headerlink" href="#updating-multiple-records-specifying-where-clause" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">Implementation is as follows when the data that matches with the condition specified by SQL is collectively updated.</div>
<div class="line">Updating multiple records by specifying WHERE clause is effective when all records are collectively updated to the same value.</div>
</div>
<ul class="simple">
<li>Xxx.java</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="kt">int</span> <span class="n">deadlineDays</span> <span class="o">=</span> <span class="mi">7</span><span class="o">;</span>
<span class="kt">int</span> <span class="n">updatedCount</span> <span class="o">=</span> <span class="n">updateDAO</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="s">&quot;todo.update&quot;</span><span class="o">,</span> <span class="n">deadlineDays</span><span class="o">);</span> <span class="c1">// (1)</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>xxx-sqlmap.xml</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre> <span class="nt">&lt;update</span> <span class="na">id=</span><span class="s">&quot;updateFinishedDeadlineByUnfinished&quot;</span> <span class="na">parameterClass=</span><span class="s">&quot;int&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (2) --&gt;</span>
     <span class="cp">&lt;![CDATA[</span>
<span class="cp">     UPDATE</span>
<span class="cp">         todo</span>
<span class="cp">     SET</span>
<span class="cp">         todo_title = &#39;[Finished Deadline]&#39; || todo_title</span>
<span class="cp">         ,version = (version + 1)</span>
<span class="cp">     WHERE</span>
<span class="cp">         finished = false</span>
<span class="cp">     AND</span>
<span class="cp">         created_at &lt; current_date - #deadlineDays#</span>
<span class="cp">     ]]&gt;</span>
<span class="nt">&lt;/update&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>Execute DAO by specifying SQLID of the SQL used for batch update and condition that extracts the data to be updated.</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td>Batch update SQL implementation. In the example, string &#8220;[Finished Deadline] &#8221; is added to the beginning of incomplete TODO titles for which 7 days have passed since their creation.</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="deleting-a-single-record">
<h4><a class="toc-backref" href="#id40">5.4.2.6.6. Deleting a single record</a><a class="headerlink" href="#deleting-a-single-record" title="Permalink to this headline">¶</a></h4>
<p>Implementation is as follows while deleting a single data record.</p>
<ul class="simple">
<li>Xxx.java</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="n">String</span> <span class="n">todoId</span> <span class="o">=</span> <span class="s">&quot;xxxxx....&quot;</span><span class="o">;</span>
<span class="kt">int</span> <span class="n">deletedCount</span> <span class="o">=</span> <span class="n">updateDAO</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="s">&quot;todo.delete&quot;</span><span class="o">,</span> <span class="n">todoId</span><span class="o">);</span> <span class="c1">// (1)</span>
<span class="k">if</span><span class="o">(</span><span class="n">deletedCount</span> <span class="o">!=</span> <span class="mi">1</span><span class="o">){</span>
    <span class="c1">// ...               // (2)</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Execute DAO by specifying PK and SQLID of the Delete SQL.</div>
<div class="line">In the example, <tt class="docutils literal"><span class="pre">java.lang.String</span></tt> is specified. However, JavaBean can also be specified in case of composite keys.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td>If required, carry out the process when the number of actually deleted records differs than the expected records.</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="deleting-multiple-records-batch-execution">
<h4><a class="toc-backref" href="#id41">5.4.2.6.7. Deleting multiple records (batch execution)</a><a class="headerlink" href="#deleting-multiple-records-batch-execution" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">Implementation for deleting multiple data records through batch execution using multiple SQL is same as that in case of updating multiple records (batch execution).</div>
<div class="line">When it is necessary to share the process for deleting a single record, use multiple records deletion by batch execution. However, when a large amount of data is to be deleted, the batch deletion by specifying the WHERE clause should be considered.</div>
</div>
</div>
<div class="section" id="deleting-multiple-records-specifying-where-clause">
<h4><a class="toc-backref" href="#id42">5.4.2.6.8. Deleting multiple records (Specifying WHERE clause)</a><a class="headerlink" href="#deleting-multiple-records-specifying-where-clause" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">Implementation for collectively deleting the data matching with SQL specified conditions is same as that in case of updating multiple records (batch execution).</div>
<div class="line">However, when a large number of records are to be deleted, batch deletion by specifying WHERE clause is effective.</div>
</div>
</div>
</div>
<div class="section" id="example-showing-use-of-storedproceduredao">
<h3><a class="toc-backref" href="#id43">5.4.2.7. Example showing use of StoredProcedureDAO</a><a class="headerlink" href="#example-showing-use-of-storedproceduredao" title="Permalink to this headline">¶</a></h3>
<p>The implementation is as follows when a procedure or a function is called.</p>
<ul class="simple">
<li>Xxx.java</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="n">SalesItem</span> <span class="n">item</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SalesItem</span><span class="o">();</span> <span class="c1">// (1)</span>
<span class="n">item</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="n">Integer</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mi">1</span><span class="o">));</span>  <span class="c1">// (2)</span>
<span class="n">storedProcedureDAO</span><span class="o">.</span><span class="na">executeForObject</span><span class="o">(</span><span class="s">&quot;todo.findSalesItem&quot;</span><span class="o">,</span> <span class="n">item</span><span class="o">);</span>  <span class="c1">// (3)</span>
<span class="c1">// (4)</span>
<span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">&quot;Quantity is {}.&quot;</span><span class="o">,</span> <span class="n">item</span><span class="o">.</span><span class="na">getQuantity</span><span class="o">());</span>
<span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">&quot;Total is {}.&quot;</span><span class="o">,</span> <span class="n">item</span><span class="o">.</span><span class="na">getTotal</span><span class="o">());</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>Generate the bind object that stores IN and OUT parameters of a procedure or function.</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td>Set the ID for IN parameter. In the example, <tt class="docutils literal"><span class="pre">1</span></tt> is set as the ID.</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td>Call <tt class="docutils literal"><span class="pre">StoredProcedureDAO</span></tt> method with bind object and SQLID of the SQL used for calling stored procedure as the argument.</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">When the method of <tt class="docutils literal"><span class="pre">StoredProcedureDAO</span></tt> is called successfully,</div>
<div class="line">OUT parameter of the procedure or function is set in bind object.</div>
<div class="line">In the example, the OUT parameter value set in bind object is output to log.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="example-showing-use-of-queryrowhandledao">
<h3><a class="toc-backref" href="#id44">5.4.2.8. Example showing use of QueryRowHandleDAO</a><a class="headerlink" href="#example-showing-use-of-queryrowhandledao" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Xxx.java</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="kt">boolean</span> <span class="n">finished</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
<span class="n">queryRowHandleDAO</span><span class="o">.</span><span class="na">executeWithRowHandler</span><span class="o">(</span>
        <span class="s">&quot;todo.findByFinished&quot;</span><span class="o">,</span>            <span class="c1">// (1)</span>
        <span class="n">finished</span><span class="o">,</span>                         <span class="c1">// (2)</span>
        <span class="k">new</span> <span class="nf">DataRowHandler</span><span class="o">()</span> <span class="o">{</span>            <span class="c1">// (3)</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handleRow</span><span class="o">(</span><span class="n">Object</span> <span class="n">valueObject</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// (4)</span>
                <span class="n">Todo</span> <span class="n">todo</span> <span class="o">=</span> <span class="o">(</span><span class="n">Todo</span><span class="o">)</span> <span class="n">valueObject</span><span class="o">;</span>
                <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="n">todo</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>  <span class="c1">// (5)</span>
            <span class="o">}</span>
        <span class="o">});</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>Specify SQLID of the SQL with search result 0 to N records.</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify SQL bind parameter.</div>
<div class="line">In the example, it is specified as boolean. However, when multiple parameters (search conditions) are passed, JavaBean can also be specified.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the implementation object of <tt class="docutils literal"><span class="pre">jp.terasoluna.fw.dao.event.DataRowHandler</span></tt>.</div>
<div class="line">In the example, an unnamed class is used. However, creating an implementation class should be considered in actual project.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">handleRow method is called for each record of search result.</div>
<div class="line">Object that is passed to an argument becomes object of the class specified in class attribute of resultMap element or the class specified in resultClass attribute of select element.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td>In the example, only log output is carried out. However, while using it in actual project, processes for file output, aggregate of each record value and value processing etc. are carried out.</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="escaping-during-like-search">
<span id="data-access-mybatis2-howtouse-like-escape"></span><h3><a class="toc-backref" href="#id45">5.4.2.9. Escaping during LIKE search</a><a class="headerlink" href="#escaping-during-like-search" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">While performing LIKE search, the values to be used as search conditions need to be escaped.</div>
<div class="line">Escaping for LIKE search can be done using methods of <tt class="docutils literal"><span class="pre">org.terasoluna.gfw.common.query.QueryEscapeUtils</span></tt> class provided by common library.</div>
<div class="line">For specifications of escaping provided by common library, refer to <a class="reference internal" href="DataAccessCommon.html#data-access-common-appendix-like-escape"><em>Escaping during LIKE search</em></a> of <a class="reference internal" href="DataAccessCommon.html"><em>Database Access (Common)</em></a>.</div>
</div>
<div class="line-block">
<div class="line">How to use escaping provided by common library, is explained below.</div>
</div>
<div class="section" id="how-to-use-escaping-when-matching-method-is-specified-in-query">
<h4><a class="toc-backref" href="#id46">5.4.2.9.1. How to use escaping when matching method is specified in Query</a><a class="headerlink" href="#how-to-use-escaping-when-matching-method-is-specified-in-query" title="Permalink to this headline">¶</a></h4>
<p>When matching method (forward match, backward match and partial match) are specified as JPQL, use a method that performs only escaping.</p>
<ul class="simple">
<li><tt class="file docutils literal"><span class="pre">xxx-sqlmap.xml</span></tt></li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre>// (1) (2)
<span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;findAllByWord&quot;</span> <span class="na">parameterClass=</span><span class="s">&quot;String&quot;</span> <span class="na">resultMap=</span><span class="s">&quot;resultMap_Article&quot;</span><span class="nt">&gt;</span>
  SELECT
      *
  FROM
      article
  WHERE
      title LIKE &#39;%&#39; || #word# || &#39;%&#39; ESCAPE &#39;~&#39;
  OR
      overview LIKE &#39;%&#39; || #word# || &#39;%&#39; ESCAPE &#39;~&#39;
<span class="nt">&lt;/select&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the wild card (<tt class="docutils literal"><span class="pre">&quot;%&quot;</span></tt> or <tt class="docutils literal"><span class="pre">&quot;_&quot;</span></tt>) for LIKE search, in SQL.</div>
<div class="line">In the above example, a matching method is a &#8220;partial match&#8221; by specifying wild card (<tt class="docutils literal"><span class="pre">&quot;%&quot;</span></tt>) before and after <tt class="docutils literal"><span class="pre">word</span></tt> argument.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify <tt class="docutils literal"><span class="pre">&quot;ESCAPE</span> <span class="pre">'~'&quot;</span></tt> at the end of LIKE clause since <tt class="docutils literal"><span class="pre">&quot;~&quot;</span></tt> is used as escape character in the escaping provided by common library.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<ul class="simple">
<li>Service or Repository</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="nd">@Inject</span>
<span class="n">QueryDAO</span> <span class="n">queryDAO</span><span class="o">;</span>

<span class="nd">@Transactional</span><span class="o">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">Page</span><span class="o">&lt;</span><span class="n">Article</span><span class="o">&gt;</span> <span class="n">searchArticle</span><span class="o">(</span><span class="n">ArticleSearchCriteria</span> <span class="n">criteria</span><span class="o">,</span>
        <span class="n">Pageable</span> <span class="n">pageable</span><span class="o">)</span> <span class="o">{</span>

    <span class="n">String</span> <span class="n">escapedWord</span> <span class="o">=</span> <span class="n">QueryEscapeUtils</span><span class="o">.</span><span class="na">toLikeCondition</span><span class="o">(</span><span class="n">criteria</span><span class="o">.</span><span class="na">getWord</span><span class="o">());</span> <span class="c1">// (3)</span>

    <span class="kt">long</span> <span class="n">total</span> <span class="o">=</span> <span class="n">queryDAO</span><span class="o">.</span><span class="na">executeForObject</span><span class="o">(</span><span class="s">&quot;article.countByWord&quot;</span><span class="o">,</span>
            <span class="n">escapedWord</span><span class="o">,</span> <span class="n">Long</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Article</span><span class="o">&gt;</span> <span class="n">contents</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="k">if</span> <span class="o">(</span><span class="mi">0</span> <span class="o">&lt;</span> <span class="n">total</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">contents</span> <span class="o">=</span> <span class="n">queryDAO</span><span class="o">.</span><span class="na">executeForObjectList</span><span class="o">(</span><span class="s">&quot;article.findAllByWord&quot;</span><span class="o">,</span>
                <span class="n">escapedWord</span><span class="o">,</span> <span class="n">pageable</span><span class="o">.</span><span class="na">getOffset</span><span class="o">(),</span> <span class="n">pageable</span><span class="o">.</span><span class="na">getPageSize</span><span class="o">());</span> <span class="c1">// (4)</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="n">contents</span> <span class="o">=</span> <span class="n">Collections</span><span class="o">.</span><span class="na">emptyList</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">PageImpl</span><span class="o">&lt;</span><span class="n">Article</span><span class="o">&gt;(</span><span class="n">contents</span><span class="o">,</span> <span class="n">pageable</span><span class="o">,</span> <span class="n">total</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">When the matching method of LIKE search is specified in Query, call <tt class="docutils literal"><span class="pre">QueryEscapeUtils#toLikeCondition(String)</span></tt> method and perform escaping for LIKE search only.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Pass the value escaped for LIKE search, to the bind parameter of <tt class="docutils literal"><span class="pre">QueryDAO</span></tt>.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="how-to-use-escaping-when-the-matching-method-is-specified-in-logic">
<h4><a class="toc-backref" href="#id47">5.4.2.9.2. How to use escaping when the matching method is specified in Logic</a><a class="headerlink" href="#how-to-use-escaping-when-the-matching-method-is-specified-in-logic" title="Permalink to this headline">¶</a></h4>
<p>When matching method (forward match, backward match and partial match) is determined at Logic side, use the method wherein wild card is assigned to the escaped value.</p>
<ul class="simple">
<li><tt class="file docutils literal"><span class="pre">xxx-sqlmap.xml</span></tt></li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre>// (1)
<span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;findAllByWord&quot;</span> <span class="na">parameterClass=</span><span class="s">&quot;String&quot;</span> <span class="na">resultMap=</span><span class="s">&quot;resultMap_Article&quot;</span><span class="nt">&gt;</span>
  SELECT
      *
  FROM
      article
  WHERE
      title LIKE #word# ESCAPE &#39;~&#39;
  OR
      overview LIKE #word# ESCAPE &#39;~&#39;
<span class="nt">&lt;/select&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Do not specify the wild card for LIKE search in SQL.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<ul class="simple">
<li>Service or Repository</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="nd">@Inject</span>
<span class="n">QueryDAO</span> <span class="n">queryDAO</span><span class="o">;</span>

<span class="nd">@Transactional</span><span class="o">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">Page</span><span class="o">&lt;</span><span class="n">Article</span><span class="o">&gt;</span> <span class="n">searchArticle</span><span class="o">(</span><span class="n">ArticleSearchCriteria</span> <span class="n">criteria</span><span class="o">,</span>
        <span class="n">Pageable</span> <span class="n">pageable</span><span class="o">)</span> <span class="o">{</span>

    <span class="n">String</span> <span class="n">escapedWord</span>  <span class="o">=</span> <span class="n">QueryEscapeUtils</span>
            <span class="o">.</span><span class="na">toContainingCondition</span><span class="o">(</span><span class="n">criteria</span><span class="o">.</span><span class="na">getWord</span><span class="o">());</span> <span class="c1">// (2)</span>

    <span class="kt">long</span> <span class="n">total</span> <span class="o">=</span> <span class="n">queryDAO</span><span class="o">.</span><span class="na">executeForObject</span><span class="o">(</span><span class="s">&quot;article.countByWord&quot;</span><span class="o">,</span>
            <span class="n">escapedWord</span><span class="o">,</span> <span class="n">Long</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Article</span><span class="o">&gt;</span> <span class="n">contents</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="k">if</span> <span class="o">(</span><span class="mi">0</span> <span class="o">&lt;</span> <span class="n">total</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">contents</span> <span class="o">=</span> <span class="n">queryDAO</span><span class="o">.</span><span class="na">executeForObjectList</span><span class="o">(</span><span class="s">&quot;article.findAllByWord&quot;</span><span class="o">,</span>
                <span class="n">escapedWord</span><span class="o">,</span> <span class="n">pageable</span><span class="o">.</span><span class="na">getOffset</span><span class="o">(),</span> <span class="n">pageable</span><span class="o">.</span><span class="na">getPageSize</span><span class="o">());</span> <span class="c1">// (3)</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="n">contents</span> <span class="o">=</span> <span class="n">Collections</span><span class="o">.</span><span class="na">emptyList</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">PageImpl</span><span class="o">&lt;</span><span class="n">Article</span><span class="o">&gt;(</span><span class="n">contents</span><span class="o">,</span> <span class="n">pageable</span><span class="o">,</span> <span class="n">total</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Call any one of the following methods while specifying the matching method in logic and assign the Escape and wild card values for LIKE search.</div>
<div class="line-block">
<div class="line"><tt class="docutils literal"><span class="pre">QueryEscapeUtils#toStartingWithCondition(String)</span></tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">QueryEscapeUtils#toEndingWithCondition(String)</span></tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">QueryEscapeUtils#toContainingCondition(String)</span></tt></div>
</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Pass the escape + wild card value assigned for LIKE search to the bind parameter of <tt class="docutils literal"><span class="pre">QueryDAO</span></tt>.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
</div>
<div class="section" id="about-the-measures-to-be-taken-against-sql-injection">
<h3><a class="toc-backref" href="#id48">5.4.2.10. About the measures to be taken against SQL Injection</a><a class="headerlink" href="#about-the-measures-to-be-taken-against-sql-injection" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">When building SQL, it is necessary to ensure prevention of SQL Injection.</div>
<div class="line">Mybatis2 provides 2 methods for embedding values in SQL.</div>
</div>
<ul>
<li><div class="first line-block">
<div class="line">Method to embed values using bind variable</div>
<div class="line">By this method, values can be safely embedded post SQL building, using <tt class="docutils literal"><span class="pre">java.sql.PreparedStatement</span></tt>.</div>
<div class="line"><strong>When embedding an input value from a user in SQL, bind variable should be used.</strong></div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Method to embed values using substitution variable.</div>
<div class="line">This method does not assure safe embedding of values since they get substituted as strings during SQL building.</div>
</div>
</li>
</ul>
<blockquote>
<div><div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>It should be noted that, when an input value from the user is embedded using substitution variable, a risk of SQL Injection attack is higher.
When it is necessary to use substitution variable to embed input value from the user, input check that ensures prevention of SQL Injection must always be implemented.</p>
<p class="last">Basically, <strong>it is strongly recommended not to use the values entered by a user as is.</strong></p>
</div>
</div></blockquote>
<div class="section" id="embedding-values-using-bind-variable">
<h4><a class="toc-backref" href="#id49">5.4.2.10.1. Embedding values using bind variable</a><a class="headerlink" href="#embedding-values-using-bind-variable" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">Use ParameterMap or Inline Parameters in case of bind variable.</div>
<div class="line">An example of usage is shown below.</div>
</div>
<p>Following example shows the use of ParameterMap.</p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- (1) --&gt;</span>
<span class="nt">&lt;parameterMap</span> <span class="na">id=</span><span class="s">&quot;uploadBinaryParameterMap&quot;</span> <span class="na">class=</span><span class="s">&quot;BinaryFile&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;parameter</span> <span class="na">property=</span><span class="s">&quot;fileId&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;parameter</span> <span class="na">property=</span><span class="s">&quot;fileName&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;parameter</span> <span class="na">property=</span><span class="s">&quot;content&quot;</span> <span class="na">jdbcType=</span><span class="s">&quot;BLOB&quot;</span> <span class="na">typeHandler=</span><span class="s">&quot;BlobInputStreamTypeHandler&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/parameterMap&gt;</span>

<span class="nt">&lt;insert</span> <span class="na">id=</span><span class="s">&quot;uploadBinary&quot;</span> <span class="na">parameterMap=</span><span class="s">&quot;uploadBinaryParameterMap&quot;</span><span class="nt">&gt;</span>
    INSERT INTO upload_binary
    (
        file_id
        ,file_name
        ,content
    )
    VALUES
    (
        ?   /* (2) */
        ,?
        ,?
    )
<span class="nt">&lt;/insert&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Define the property that embeds the value as bind variable. Defined order should correspond with the position of <tt class="docutils literal"><span class="pre">?</span></tt> specified in (2).</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify the bind variable in SQL. Values are bound to  <tt class="docutils literal"><span class="pre">?</span></tt> part as per the order defined in (1).</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Following example shows the use of Inline Parameters.</p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;insert</span> <span class="na">id=</span><span class="s">&quot;insert&quot;</span>
        <span class="na">parameterClass=</span><span class="s">&quot;xxxxxx.yyyyyy.zzzzzz.domain.model.Todo&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
    INSERT INTO todo
        (
            todo_id
            ,todo_title
            ,finished
            ,created_at
            ,version
        )
        values(
            #todoId#       /* (3) */
            ,#todoTitle#
            ,#finished#
            ,#createdAt#
            ,1
        )
<span class="nt">&lt;/insert&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Specify name of the property that stores bind value as bind variable by enclosing it in <tt class="docutils literal"><span class="pre">#</span></tt>.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="how-to-embed-a-value-using-substitution-variable">
<h4><a class="toc-backref" href="#id50">5.4.2.10.2. How to embed a value using substitution variable</a><a class="headerlink" href="#how-to-embed-a-value-using-substitution-variable" title="Permalink to this headline">¶</a></h4>
<p>Following example shows the use of bind variable.</p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;findByFinished&quot;</span>
        <span class="na">parameterClass=</span><span class="s">&quot;...&quot;</span>
        <span class="na">resultMap=</span><span class="s">&quot;resultMap_Todo&quot;</span><span class="nt">&gt;</span>
    SELECT
        *
    FROM
        todo
    WHERE
        finished = #finished#
    ORDER BY
        created_at $direction$  /* (4) */
<span class="nt">&lt;/select&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Enclose name of the property that stores the value to be substituted, with  <tt class="docutils literal"><span class="pre">$</span></tt> and specify it as substitution variable.</div>
<div class="line">In the above example, <tt class="docutils literal"><span class="pre">$direction$</span></tt> is replaced either by <tt class="docutils literal"><span class="pre">&quot;DESC&quot;</span></tt> or <tt class="docutils literal"><span class="pre">&quot;ASC&quot;</span></tt>.</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>It is recommended to embed values using substitution variable on ensuring that the value is safe for the application and limiting its usage to table names, column names and sort conditions etc.</p>
<p>As shown in the example below, it is desirable to store the code value and the safe value to be actually used, in Map as a pair</p>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">safeValueMap</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;();</span>
<span class="n">safeValueMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;1&quot;</span><span class="o">,</span> <span class="s">&quot;ASC&quot;</span><span class="o">);</span>
<span class="n">safeValueMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;2&quot;</span><span class="o">,</span> <span class="s">&quot;DESC&quot;</span><span class="o">);</span>
</pre></div>
</div>
</div></blockquote>
<p>and to convert the value during SQL execution so that actual input is changed to code value.</p>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="n">String</span> <span class="n">direction</span> <span class="o">=</span> <span class="n">safeValueMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">input</span><span class="o">.</span><span class="na">getDirection</span><span class="o">());</span>
</pre></div>
</div>
</div></blockquote>
<p class="last"><a class="reference internal" href="Codelist.html"><em>Codelist</em></a> can also be used.</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
</div>
<div class="section" id="appendix">
<h2><a class="toc-backref" href="#id51">5.4.3. Appendix</a><a class="headerlink" href="#appendix" title="Permalink to this headline">¶</a></h2>
<div class="section" id="implementation-wherein-related-objects-are-fetched-collectively-by-a-single-sql">
<h3><a class="toc-backref" href="#id52">5.4.3.1. Implementation wherein related objects are fetched collectively by a single SQL</a><a class="headerlink" href="#implementation-wherein-related-objects-are-fetched-collectively-by-a-single-sql" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">How to fetch related objects collectively by a single SQL while accessing database, by providing a JavaBean such as Entity for each table, is explained below.</div>
<div class="line">This method is also used to prevent N+1.</div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>Following points should be noted while using this implementation.</p>
<ul class="last simple">
<li>In this example, all related objects are fetched collectively in a single SQL, in order to explain the method.
However, in actual project, it must be ensured to fetch only the related objects that are required in the process.
This is because the simultaneous fetching of unused related objects can result in performance degradation in some cases.</li>
<li>Related objects with 1:N ratio that are rarely used, are not fetched collectively.
Fetching such related objects individually, when required, has proved to be better.
They may be fetched collectively if the performance requirements are satisfied.</li>
<li>When there are many related objects with 1:N ratio, fetching them collectively has degraded the performance in some cases as unnecessary data not used in mapping is fetched.
They may be fetched collectively if the performance requirements are satisfied. However, it is better to look out for other methods.</li>
</ul>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">For details on how to avoid N+1, refer to &#8220;Result Maps/Avoiding N+1 Selects (1:1)&#8221; (P.37-38) and &#8220;Result Maps/Avoiding N+1 Selects (1:M and M:N)&#8221; (P.39-40) of Mybatis Developer Guide (PDF).</p>
</div>
<div class="line-block">
<div class="line">Implementation using order table is explained below.</div>
<div class="line">Table used is as follows:</div>
</div>
<blockquote>
<div><div class="figure align-center">
<a class="reference internal image-reference" href="../_images/dataaccess_er.png"><img alt="ER diagram" src="../_images/dataaccess_er.png" style="width: 90%;" /></a>
<p class="caption"><strong>Picture - ER diagram</strong></p>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="20%" />
<col width="15%" />
<col width="55%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Category</th>
<th class="head">Table name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>Transaction system</td>
<td>t_order</td>
<td>Table that stores the order. 1 record is stored for 1 order.</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td>&nbsp;</td>
<td>t_order_item</td>
<td>Table that stores products purchased in a single order. When multiple products are purchased in a single order, records of multiple products are stored.</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td>&nbsp;</td>
<td>t_order_coupon</td>
<td>Table that stores coupons used in one order. When multiple coupons are used in one order, multiple coupon records are stored. No record is stored if a coupon is not used.</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td>Master system</td>
<td>m_item</td>
<td>Master table for defining the product.</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td>&nbsp;</td>
<td>m_category</td>
<td>Master table for defining the category.</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td>&nbsp;</td>
<td>m_item_category</td>
<td>Master table for defining category to which the product belongs. It stores the mapping of product and category. It serves as a model wherein a single product can belong to multiple categories.</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td>&nbsp;</td>
<td>m_coupon</td>
<td>Master table for defining the coupon.</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(8)</div>
</div>
</td>
<td>Code system</td>
<td>c_order_status</td>
<td>Code table for defining the order status.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Transaction table layout and records stored are as follows:</p>
<blockquote>
<div><p><strong>t_order</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">id(PK)</th>
<th class="head">status_code</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td>accepted</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>checking</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<blockquote>
<div><p><strong>t_order_item</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">order_id(PK)</th>
<th class="head">item_code(PK)</th>
<th class="head">quantity</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td>ITM0000001</td>
<td>10</td>
</tr>
<tr class="row-odd"><td>1</td>
<td>ITM0000002</td>
<td>20</td>
</tr>
<tr class="row-even"><td>2</td>
<td>ITM0000001</td>
<td>30</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>ITM0000002</td>
<td>40</td>
</tr>
</tbody>
</table>
<p><strong>t_order_coupon</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">order_id(PK)</th>
<th class="head">coupon_code(PK)</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td>CPN0000001</td>
</tr>
<tr class="row-odd"><td>1</td>
<td>CPN0000002</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Master table layout and records stored are as follows:</p>
<blockquote>
<div><p><strong>m_item</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">code(PK)</th>
<th class="head">name</th>
<th class="head">price</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>ITM0000001</td>
<td>Orange juice</td>
<td>100</td>
</tr>
<tr class="row-odd"><td>ITM0000002</td>
<td>NotePC</td>
<td>100000</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<blockquote>
<div><p><strong>m_category</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">code(PK)</th>
<th class="head">name</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>CTG0000001</td>
<td>Drink</td>
</tr>
<tr class="row-odd"><td>CTG0000002</td>
<td>PC</td>
</tr>
<tr class="row-even"><td>CTG0000003</td>
<td>Hot selling</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<blockquote>
<div><p><strong>m_item_category</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">item_code(PK)</th>
<th class="head">category_code(PK)</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>ITM0000001</td>
<td>CTG0000001</td>
</tr>
<tr class="row-odd"><td>ITM0000002</td>
<td>CTG0000002</td>
</tr>
<tr class="row-even"><td>ITM0000002</td>
<td>CTG0000003</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<blockquote>
<div><p><strong>m_coupon</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">code(PK)</th>
<th class="head">name</th>
<th class="head">price</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>CPN0000001</td>
<td>Join coupon</td>
<td>3000</td>
</tr>
<tr class="row-odd"><td>CPN0000002</td>
<td>PC coupon</td>
<td>30000</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Code table layout and records stored are as follows:</p>
<blockquote>
<div><p><strong>c_order_status</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">code(PK)</th>
<th class="head">name</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>accepted</td>
<td>Order accepted</td>
</tr>
<tr class="row-odd"><td>checking</td>
<td>Stock checking</td>
</tr>
<tr class="row-even"><td>shipped</td>
<td>Item Shipped</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>In the following implementation, data stored in above tables is fetched by mapping with the JavaBean mentioned below.</p>
<blockquote>
<div><div class="figure align-center">
<a class="reference internal image-reference" href="../_images/dataaccess_entity.png"><img alt="Class(JavaBean) diagram" src="../_images/dataaccess_entity.png" style="width: 90%;" /></a>
<p class="caption"><strong>Picture - Class (JavaBean) diagram</strong></p>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="17%" />
<col width="72%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Class name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>Order</td>
<td>JavaBean that represents one record of t_order table. <tt class="docutils literal"><span class="pre">OrderStatus</span></tt>, <tt class="docutils literal"><span class="pre">OrderItem</span></tt> and  <tt class="docutils literal"><span class="pre">OrderCoupon</span></tt> are stored as multiple related objects.</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td>OrderItem</td>
<td>JavaBean that represents one record of t_order_item table. <tt class="docutils literal"><span class="pre">Item</span></tt> is stored as related object.</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td>OrderCoupon</td>
<td>JavaBean that represents one record of t_order_coupon table. <tt class="docutils literal"><span class="pre">Coupon</span></tt> is stored as related object.</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td>Item</td>
<td>JavaBean that represents one record of m_item table. Multiple  <tt class="docutils literal"><span class="pre">Category</span></tt> to which the records belong are stored as related objects. <tt class="docutils literal"><span class="pre">Item</span></tt> and <tt class="docutils literal"><span class="pre">Category</span></tt> are associated by m_item_category table.</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td>Category</td>
<td>JavaBean that represents one record of m_category table.</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td>Coupon</td>
<td>JavaBean that represents one record of m_coupon table.</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td>OrderStatus</td>
<td>JavaBean that represents one record of c_order_status table.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>JavaBean property definition is as follows:</p>
<ul class="simple">
<li>Order.java</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Order</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">orderItems</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderCoupon</span><span class="o">&gt;</span> <span class="n">orderCoupons</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">OrderStatus</span> <span class="n">status</span><span class="o">;</span>
    <span class="c1">// ...</span>
<span class="o">}</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>OrderItem.java</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderItem</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">orderId</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">itemCode</span><span class="o">;</span> <span class="c1">// &lt;!-- (1) --&gt;</span>
    <span class="kd">private</span> <span class="n">Item</span> <span class="n">item</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">quantity</span><span class="o">;</span>
    <span class="c1">// ...</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>Value to be stored overlaps with <tt class="docutils literal"><span class="pre">code</span></tt> property of the immediately subsequent <tt class="docutils literal"><span class="pre">item</span></tt> variable. This is defined since it is required while grouping the records using groupBy attribute of resultMap element, described later.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<ul class="simple">
<li>OrderCoupon.java</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderCoupon</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">orderId</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">couponCode</span><span class="o">;</span> <span class="c1">// (1)</span>
    <span class="kd">private</span> <span class="n">Coupon</span> <span class="n">coupon</span><span class="o">;</span>
    <span class="c1">// ...</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>Value to be stored overlaps with <tt class="docutils literal"><span class="pre">code</span></tt> property of the immediately subsequent <tt class="docutils literal"><span class="pre">Coupon</span></tt> variable. This is defined since it is required while grouping the records using groupBy attribute of resultMap element, described later.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<ul class="simple">
<li>Item.java</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Item</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">code</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">price</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">categories</span><span class="o">;</span>
    <span class="c1">// ...</span>
<span class="o">}</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>Category.java</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Category</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">code</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="c1">// ...</span>
<span class="o">}</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>Coupon.java</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Coupon</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">code</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">price</span><span class="o">;</span>
    <span class="c1">// ...</span>
<span class="o">}</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>OrderStatus.java</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderStatus</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">code</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="c1">// ...</span>
<span class="o">}</span>
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line">Implement SQL mapping.</div>
<div class="line">When related objects are collectively fetched in a single SQL, JOIN the tables to be fetched and acquire all the records necessary for mapping.</div>
<div class="line">Perform mapping definition for the fetched records in resultMap element and map with JavaBean.</div>
</div>
<div class="line-block">
<div class="line">Following implementations show the SQL that fetches a single Order (findOne) and one that fetches all Orders (findAll).</div>
<div class="line">Further, in following implementation,  <tt class="docutils literal"><span class="pre">&quot;order&quot;</span></tt> is specified in name space and the class name without package name, defined using typeAlias, is assumed for the JavaBean to be mapped.</div>
</div>
<ul class="simple">
<li>sqlMapConfig.xml</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;typeAlias</span> <span class="na">alias=</span><span class="s">&quot;Order&quot;</span> <span class="na">type=</span><span class="s">&quot;xxxxxx.yyyyyy.zzzzzz.domain.model.Order&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;typeAlias</span> <span class="na">alias=</span><span class="s">&quot;OrderStatus&quot;</span> <span class="na">type=</span><span class="s">&quot;xxxxxx.yyyyyy.zzzzzz.domain.model.OrderStatus&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;typeAlias</span> <span class="na">alias=</span><span class="s">&quot;OrderItem&quot;</span> <span class="na">type=</span><span class="s">&quot;xxxxxx.yyyyyy.zzzzzz.domain.model.OrderItem&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;typeAlias</span> <span class="na">alias=</span><span class="s">&quot;OrderCoupon&quot;</span> <span class="na">type=</span><span class="s">&quot;xxxxxx.yyyyyy.zzzzzz.domain.model.OrderCoupon&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;typeAlias</span> <span class="na">alias=</span><span class="s">&quot;Item&quot;</span> <span class="na">type=</span><span class="s">&quot;xxxxxx.yyyyyy.zzzzzz.domain.model.Item&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;typeAlias</span> <span class="na">alias=</span><span class="s">&quot;Category&quot;</span> <span class="na">type=</span><span class="s">&quot;xxxxxx.yyyyyy.zzzzzz.domain.model.Category&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;typeAlias</span> <span class="na">alias=</span><span class="s">&quot;Coupon&quot;</span> <span class="na">type=</span><span class="s">&quot;xxxxxx.yyyyyy.zzzzzz.domain.model.Coupon&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>order-sqlmap.xml</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;sqlMap</span> <span class="na">namespace=</span><span class="s">&quot;order&quot;</span><span class="nt">&gt;</span>

    <span class="c">&lt;!-- ... --&gt;</span>

<span class="nt">&lt;/sqlMap&gt;</span>
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line">At first, describe the SQL</div>
<div class="line">Actual definition should be subsequent to the resultMap element.</div>
</div>
<p>Implementing SQL</p>
<ul class="simple">
<li>SQL definitions (sql elements) of the common parts of findOne/findAll</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;sql</span> <span class="na">id=</span><span class="s">&quot;fragment_selectFormJoin&quot;</span><span class="nt">&gt;</span>         <span class="c">&lt;!-- (1) --&gt;</span>
    SELECT                                   /* (2) */
        o.id
        ,os.code AS status_code
        ,os.name AS status_name
        ,ol.quantity
        ,i.code AS item_code
        ,i.name AS item_name
        ,i.price AS item_price
        ,ct.code AS category_code
        ,ct.name AS category_name
        ,cp.code AS coupon_code
        ,cp.name AS coupon_name
        ,cp.price AS coupon_price
    FROM
        t_order o
    INNER JOIN                                /* (3) */
        c_order_status os
            ON os.code = o.status_code
    INNER JOIN
        t_orderline ol
            ON ol.order_id = o.id
    INNER JOIN
        m_item i
            ON i.code = ol.item_code
    INNER JOIN
        m_item_category ic
            ON ic.item_code = i.code
    INNER JOIN
        m_category ct
            ON ct.code = ic.category_code
    LEFT JOIN                                  /* (4) */
        t_order_coupon oc
            ON oc.order_id = o.id
    LEFT JOIN
        m_coupon cp
            ON cp.code = oc.coupon_code
<span class="nt">&lt;/sql&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>sql elements used to share SELECT clause, FROM clause and JOIN clause in findOne and findAll. They have been standardized as there are many common parts in the SQLs for findOne and findAll.</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td>Fetch all the data required to generate related objects. Ensure that the column name is not repeated. In the above example, since there are duplicate <tt class="docutils literal"><span class="pre">code</span></tt>, <tt class="docutils literal"><span class="pre">name</span></tt> and <tt class="docutils literal"><span class="pre">price</span></tt>, an alias is specified for them using AS clause.</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td>Join the tables storing the data required to generate related objects.</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td>Perform Outer JOIN for the tables in which data may not be stored. When coupon is not used, records are not stored in t_group_coupon; hence Outer JOIN should be used. This is also applicable for t_coupon that joins with t_group_coupon.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<ul class="simple">
<li>SQL definition for findOne</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;findOne&quot;</span> <span class="na">parameterClass=</span><span class="s">&quot;java.lang.Integer&quot;</span> <span class="na">resultMap=</span><span class="s">&quot;orderResultMap&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
    <span class="nt">&lt;include</span> <span class="na">refid=</span><span class="s">&quot;fragment_selectFormJoin&quot;</span><span class="nt">/&gt;</span> <span class="c">&lt;!-- (2) --&gt;</span>
    WHERE
        o.id = #id#         /* (3) */
    ORDER BY                /* (4) */
        item_code ASC       /* (5) */
        ,category_code ASC  /* (6) */
        ,coupon_code ASC    /* (7) */
<span class="nt">&lt;/select&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>SQL for fetching related object and <tt class="docutils literal"><span class="pre">Order</span></tt> object of the specified order ID.</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td>Includes the SQL that implements SELECT clause, FROM clause and JOIN clause which are shared with findAll.</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td>Specify the order ID  passed by bind value, in WHERE clause.</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td>When related objects with 1:N ratio exist, specify the ORDER BY clause to control the order within the list. Need not be specified if there is no significance to the order.</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td>To be specified in order to set the <tt class="docutils literal"><span class="pre">Order#orderItems</span></tt> list in ascending order of code column of t_item table.</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td>To be specified in order to set the <tt class="docutils literal"><span class="pre">Item#categories</span></tt> list in ascending order of code column of t_category table.</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td>To be specified in order to set the <tt class="docutils literal"><span class="pre">Order#orderCoupons</span></tt> list in ascending order of t_coupon codes.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<ul class="simple">
<li>SQL definition of findAll</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;findAll&quot;</span> <span class="na">resultMap=</span><span class="s">&quot;orderResultMap&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
    <span class="nt">&lt;include</span> <span class="na">refid=</span><span class="s">&quot;fragment_selectFormJoin&quot;</span><span class="nt">/&gt;</span> <span class="c">&lt;!-- (2) --&gt;</span>
    ORDER BY
        o.id DESC     /* (3) */
        ,i.code ASC
        ,ct.code ASC
        ,cp.code ASC
<span class="nt">&lt;/select&gt;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td>SQL to fetch all Orders and related objects.</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td>sql element that shares the SELECT clause, FROM clause and JOIN clause in findOne and findAll.</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td>To be specified so as to set the order of fetched list in descending order of t_order ids.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line">Following records are fetched on implementing the above SQL (findAll).</div>
<div class="line">2 records are fetched as order records. However a total of 9 records are fetched as it joins with related table that stores multiple records.</div>
<div class="line">1st~3rd rows are records that generate <tt class="docutils literal"><span class="pre">Order</span></tt> objects with order ID  <tt class="docutils literal"><span class="pre">2</span></tt> whereas rows 4th~9th are records that generate <tt class="docutils literal"><span class="pre">Order</span></tt> objects with order ID  <tt class="docutils literal"><span class="pre">1</span></tt>.</div>
</div>
<blockquote>
<div><div class="figure align-center">
<a class="reference internal image-reference" href="../_images/dataaccess_sql_result.png"><img alt="Result Set of findAll" src="../_images/dataaccess_sql_result.png" style="width: 100%;" /></a>
<p class="caption"><strong>Picture - Result Set of findAll</strong></p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>How to map the above records with <tt class="docutils literal"><span class="pre">Order</span></tt> object and related objects is explained below.</p>
<div class="line-block">
<div class="line">Implementing resultMap element</div>
<div class="line">Each element is explained later.</div>
</div>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&quot;orderResultMap&quot;</span> <span class="na">class=</span><span class="s">&quot;Order&quot;</span> <span class="na">groupBy=</span><span class="s">&quot;id&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;id&quot;</span> <span class="na">column=</span><span class="s">&quot;id&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;status&quot;</span> <span class="na">resultMap=</span><span class="s">&quot;order.orderStatusResultMap&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;orderItems&quot;</span> <span class="na">resultMap=</span><span class="s">&quot;order.orderItemResultMap&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;orderCoupons&quot;</span> <span class="na">resultMap=</span><span class="s">&quot;order.orderCouponResultMap&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/resultMap&gt;</span>

<span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&quot;orderStatusResultMap&quot;</span> <span class="na">class=</span><span class="s">&quot;OrderStatus&quot;</span> <span class="na">groupBy=</span><span class="s">&quot;code&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;code&quot;</span> <span class="na">column=</span><span class="s">&quot;status_code&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;name&quot;</span> <span class="na">column=</span><span class="s">&quot;status_name&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/resultMap&gt;</span>

<span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&quot;orderItemResultMap&quot;</span> <span class="na">class=</span><span class="s">&quot;OrderItem&quot;</span> <span class="na">groupBy=</span><span class="s">&quot;itemCode&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;itemCode&quot;</span> <span class="na">column=</span><span class="s">&quot;item_code&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;item&quot;</span> <span class="na">resultMap=</span><span class="s">&quot;order.itemResultMap&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;quantity&quot;</span> <span class="na">column=</span><span class="s">&quot;quantity&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/resultMap&gt;</span>

<span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&quot;itemResultMap&quot;</span> <span class="na">class=</span><span class="s">&quot;Item&quot;</span> <span class="na">groupBy=</span><span class="s">&quot;code&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;code&quot;</span> <span class="na">column=</span><span class="s">&quot;item_code&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;name&quot;</span> <span class="na">column=</span><span class="s">&quot;item_name&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;price&quot;</span> <span class="na">column=</span><span class="s">&quot;item_price&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;categories&quot;</span> <span class="na">resultMap=</span><span class="s">&quot;order.categoryResultMap&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/resultMap&gt;</span>

<span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&quot;categoryResultMap&quot;</span> <span class="na">class=</span><span class="s">&quot;Category&quot;</span> <span class="na">groupBy=</span><span class="s">&quot;code&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;code&quot;</span> <span class="na">column=</span><span class="s">&quot;category_code&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;name&quot;</span> <span class="na">column=</span><span class="s">&quot;category_name&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/resultMap&gt;</span>

<span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&quot;orderCouponResultMap&quot;</span> <span class="na">class=</span><span class="s">&quot;OrderCoupon&quot;</span> <span class="na">groupBy=</span><span class="s">&quot;couponCode&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;couponCode&quot;</span> <span class="na">column=</span><span class="s">&quot;coupon_code&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;coupon&quot;</span> <span class="na">resultMap=</span><span class="s">&quot;order.couponResultMap&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/resultMap&gt;</span>

<span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&quot;couponResultMap&quot;</span> <span class="na">class=</span><span class="s">&quot;Coupon&quot;</span> <span class="na">groupBy=</span><span class="s">&quot;code&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;code&quot;</span> <span class="na">column=</span><span class="s">&quot;coupon_code&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;name&quot;</span> <span class="na">column=</span><span class="s">&quot;coupon_name&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;price&quot;</span> <span class="na">column=</span><span class="s">&quot;coupon_price&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/resultMap&gt;</span>
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>The role of each resultMap element and its dependency is as shown below.</p>
<blockquote>
<div><div class="figure align-center">
<a class="reference internal image-reference" href="../_images/dataaccess_resultmap.png"><img alt="Implementation of ResultMap" src="../_images/dataaccess_resultmap.png" style="width: 100%;" /></a>
<p class="caption"><strong>Picture - Implementation of ResultMap</strong></p>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Definition to map the fetched records to <tt class="docutils literal"><span class="pre">Order</span></tt> objects.</div>
<div class="line">Mapping of related objects (<tt class="docutils literal"><span class="pre">OrderStatus</span></tt>, <tt class="docutils literal"><span class="pre">OrderItem</span></tt> and <tt class="docutils literal"><span class="pre">OrderCoupon</span></tt>) is delegated to another resultMap.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Definition to map the fetched records to <tt class="docutils literal"><span class="pre">OrderStatus</span></tt> objects.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Definition to map the fetched records to <tt class="docutils literal"><span class="pre">OrderItem</span></tt> objects.</div>
<div class="line">Mapping of related object (<tt class="docutils literal"><span class="pre">Item</span></tt>) is delegated to another resultMap.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Definition to map the fetched records to  <tt class="docutils literal"><span class="pre">Item</span></tt> objects.</div>
<div class="line">Mapping of related object (<tt class="docutils literal"><span class="pre">Category</span></tt>) is delegated to another resultMap.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Definition to map the fetched records to <tt class="docutils literal"><span class="pre">Category</span></tt> objects.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Definition to map the fetched records to <tt class="docutils literal"><span class="pre">OrderCoupon</span></tt> objects.</div>
<div class="line">Mapping of related object (<tt class="docutils literal"><span class="pre">Coupon</span></tt>) is delegated to another resultMap.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Definition to map the fetched records to <tt class="docutils literal"><span class="pre">Coupon</span></tt> objects.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Mapping the records to <tt class="docutils literal"><span class="pre">Order</span></tt> object.</p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&quot;orderResultMap&quot;</span> <span class="na">class=</span><span class="s">&quot;Order&quot;</span> <span class="na">groupBy=</span><span class="s">&quot;id&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;id&quot;</span> <span class="na">column=</span><span class="s">&quot;id&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (2) --&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;status&quot;</span> <span class="na">resultMap=</span><span class="s">&quot;order.orderStatusResultMap&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (3) --&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;orderItems&quot;</span> <span class="na">resultMap=</span><span class="s">&quot;order.orderItemResultMap&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (4) --&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;orderCoupons&quot;</span> <span class="na">resultMap=</span><span class="s">&quot;order.orderCouponResultMap&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (5) --&gt;</span>
<span class="nt">&lt;/resultMap&gt;</span>
</pre></div>
</div>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/dataaccess_resultmap_order.png"><img alt="ResultMap for Order" src="../_images/dataaccess_resultmap_order.png" style="width: 100%;" /></a>
<p class="caption"><strong>Picture - ResultMap for Order</strong></p>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">It is necessary to group the fetched records for each order. For this, specify the <tt class="docutils literal"><span class="pre">id</span></tt> property storing the value which uniquely identifies the order, in groupBy attribute.</div>
<div class="line">In this example, as the records are grouped by <tt class="docutils literal"><span class="pre">id</span></tt> property, 2 <tt class="docutils literal"><span class="pre">Order</span></tt> objects namely, <tt class="docutils literal"><span class="pre">id=1</span></tt> and <tt class="docutils literal"><span class="pre">id=2</span></tt> are generated.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set the <tt class="docutils literal"><span class="pre">id</span></tt> column value of fetched records in <tt class="docutils literal"><span class="pre">Order#id</span></tt>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Delegate generation of <tt class="docutils literal"><span class="pre">OrderStatus</span></tt> objects to the <tt class="docutils literal"><span class="pre">id=&quot;order.orderStatusResultMap&quot;</span></tt> resultMap and set the generated objects in <tt class="docutils literal"><span class="pre">Order#status</span></tt>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Delegate generation of <tt class="docutils literal"><span class="pre">OrderItem</span></tt> objects to the <tt class="docutils literal"><span class="pre">id=&quot;order.orderItemResultMap&quot;</span></tt> resultMap and add the generated objects in <tt class="docutils literal"><span class="pre">Order#orderItems</span></tt> list.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td>Delegate generation of <tt class="docutils literal"><span class="pre">OrderCoupon</span></tt> objects to the <tt class="docutils literal"><span class="pre">id=&quot;order.orderCouponResultMap&quot;</span></tt> resultMap and add the generated objects in <tt class="docutils literal"><span class="pre">Order#orderCoupons</span></tt> list.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Following is described mainly focusing on <tt class="docutils literal"><span class="pre">id=1</span></tt>  <tt class="docutils literal"><span class="pre">Order</span></tt> object mapping.</p>
<p>Mapping the records to <tt class="docutils literal"><span class="pre">OrderStatus</span></tt> objects.</p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&quot;orderStatusResultMap&quot;</span> <span class="na">class=</span><span class="s">&quot;OrderStatus&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;code&quot;</span> <span class="na">column=</span><span class="s">&quot;status_code&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (2) --&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;name&quot;</span> <span class="na">column=</span><span class="s">&quot;status_name&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (3) --&gt;</span>
<span class="nt">&lt;/resultMap&gt;</span>
</pre></div>
</div>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/dataaccess_resultmap_orderstatus.png"><img alt="ResultMap for OrderStatus" src="../_images/dataaccess_resultmap_orderstatus.png" style="width: 100%;" /></a>
<p class="caption"><strong>Picture - ResultMap for OrderStatus</strong></p>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">It is not necessary to specify groupBy attribute since there is a 1:1 relationship between <tt class="docutils literal"><span class="pre">Order</span></tt> and <tt class="docutils literal"><span class="pre">OrderStatus</span></tt>.</div>
<div class="line">In this example, <tt class="docutils literal"><span class="pre">OrderStatus</span></tt> object of <tt class="docutils literal"><span class="pre">code=accepted</span></tt> is generated.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set the <tt class="docutils literal"><span class="pre">status_code</span></tt> column values of fetched records to <tt class="docutils literal"><span class="pre">OrderStatus#code</span></tt>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Set the <tt class="docutils literal"><span class="pre">status_name</span></tt> column values of fetched records to <tt class="docutils literal"><span class="pre">OrderStatus#name</span></tt>.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Mapping to <tt class="docutils literal"><span class="pre">OrderItem</span></tt> objects.</p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&quot;orderItemResultMap&quot;</span> <span class="na">class=</span><span class="s">&quot;OrderItem&quot;</span> <span class="na">groupBy=</span><span class="s">&quot;itemCode&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;itemCode&quot;</span> <span class="na">column=</span><span class="s">&quot;item_code&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (2) --&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;item&quot;</span> <span class="na">resultMap=</span><span class="s">&quot;order.itemResultMap&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (3) --&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;quantity&quot;</span> <span class="na">column=</span><span class="s">&quot;quantity&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (4) --&gt;</span>
<span class="nt">&lt;/resultMap&gt;</span>
</pre></div>
</div>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/dataaccess_resultmap_orderitem.png"><img alt="ResultMap for OrderItem" src="../_images/dataaccess_resultmap_orderitem.png" style="width: 100%;" /></a>
<p class="caption"><strong>Picture - ResultMap for OrderItem</strong></p>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">It is necessary to specify groupBy attribute since there is a 1:N relationship between <tt class="docutils literal"><span class="pre">Order</span></tt> and  <tt class="docutils literal"><span class="pre">OrderItem</span></tt>.</div>
<div class="line">Order products need to be grouped with the primary keys of t_order_item (order_id, item_code). Since order_id column is specified in the parent resultMap, specify only <tt class="docutils literal"><span class="pre">itemCode</span></tt> property that stores the values of item_code column.</div>
<div class="line">In this example, as the order products are grouped in <tt class="docutils literal"><span class="pre">itemCode</span></tt> property, 2 <tt class="docutils literal"><span class="pre">OrderItem</span></tt> objects namely <tt class="docutils literal"><span class="pre">itemCode=ITM0000001</span></tt> and <tt class="docutils literal"><span class="pre">itemCode=ITM0000002</span></tt> are generated.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><tt class="docutils literal"><span class="pre">item_code</span></tt> column values of fetched records are set in <tt class="docutils literal"><span class="pre">OrderItem#itemCode</span></tt>.</div>
<div class="line"><tt class="docutils literal"><span class="pre">itemCode</span></tt> property overlaps with <tt class="docutils literal"><span class="pre">Item#code</span></tt> generated in (3). However, it is necessary for grouping <tt class="docutils literal"><span class="pre">OrderItem</span></tt>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Generation of <tt class="docutils literal"><span class="pre">Item</span></tt> object is delegated to <tt class="docutils literal"><span class="pre">id=&quot;order.itemResultMap&quot;</span></tt> resultMap and the generated object is set in <tt class="docutils literal"><span class="pre">OrderItem#item</span></tt>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><tt class="docutils literal"><span class="pre">quantity</span></tt> column values of fetched records are set in <tt class="docutils literal"><span class="pre">OrderItem#quantity</span></tt>.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Mapping the records to <tt class="docutils literal"><span class="pre">Item</span></tt> objects.</p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&quot;itemResultMap&quot;</span> <span class="na">class=</span><span class="s">&quot;Item&quot;</span> <span class="na">groupBy=</span><span class="s">&quot;code&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;code&quot;</span> <span class="na">column=</span><span class="s">&quot;item_code&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (2) --&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;name&quot;</span> <span class="na">column=</span><span class="s">&quot;item_name&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (3) --&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;price&quot;</span> <span class="na">column=</span><span class="s">&quot;item_price&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (4) --&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;categories&quot;</span> <span class="na">resultMap=</span><span class="s">&quot;order.categoryResultMap&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (5) --&gt;</span>
<span class="nt">&lt;/resultMap&gt;</span>
</pre></div>
</div>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/dataaccess_resultmap_item.png"><img alt="ResultMap for Item" src="../_images/dataaccess_resultmap_item.png" style="width: 100%;" /></a>
<p class="caption"><strong>Picture - ResultMap for Item</strong></p>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">There is a 1:1 relationship between <tt class="docutils literal"><span class="pre">OrderItem</span></tt> and <tt class="docutils literal"><span class="pre">Item</span></tt>; however since <tt class="docutils literal"><span class="pre">Item</span></tt> and <tt class="docutils literal"><span class="pre">Category</span></tt> have 1:N relationship, groupBy attribute needs to be specified.</div>
<div class="line">It is necessary to group the categories for each product. Therefore, specify <tt class="docutils literal"><span class="pre">code</span></tt> property storing the value which uniquely identifies the order, in groupBy attribute.</div>
<div class="line">In this example, <tt class="docutils literal"><span class="pre">Item</span></tt> object of <tt class="docutils literal"><span class="pre">code=ITM0000001</span></tt>is generated for <tt class="docutils literal"><span class="pre">OrderItem#itemCode=ITM0000001</span></tt> and  <tt class="docutils literal"><span class="pre">Item</span></tt> object of <tt class="docutils literal"><span class="pre">code=ITM0000002</span></tt> is generated for <tt class="docutils literal"><span class="pre">OrderItem#itemCode=ITM0000002</span></tt>. (Total 2 objects are generated.)</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><tt class="docutils literal"><span class="pre">item_code</span></tt> column values of fetched records are set in <tt class="docutils literal"><span class="pre">Item#code</span></tt>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><tt class="docutils literal"><span class="pre">item_name</span></tt> column values of fetched records are set in <tt class="docutils literal"><span class="pre">Item#name</span></tt>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><tt class="docutils literal"><span class="pre">item_price</span></tt> column values of fetched records are set in <tt class="docutils literal"><span class="pre">Item#price</span></tt>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Delegate generation of <tt class="docutils literal"><span class="pre">Category</span></tt> objects to <tt class="docutils literal"><span class="pre">id=&quot;order.categoryResultMap&quot;</span></tt> resultMap and add the generated objects to  <tt class="docutils literal"><span class="pre">Item#categories</span></tt> list.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Mapping the records to <tt class="docutils literal"><span class="pre">Category</span></tt> objects.</p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&quot;categoryResultMap&quot;</span> <span class="na">class=</span><span class="s">&quot;Category&quot;</span> <span class="na">groupBy=</span><span class="s">&quot;code&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;code&quot;</span> <span class="na">column=</span><span class="s">&quot;category_code&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;name&quot;</span> <span class="na">column=</span><span class="s">&quot;category_name&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
<span class="nt">&lt;/resultMap&gt;</span>
</pre></div>
</div>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/dataaccess_resultmap_category.png"><img alt="ResultMap for Item" src="../_images/dataaccess_resultmap_category.png" style="width: 100%;" /></a>
<p class="caption"><strong>Picture - ResultMap for Item</strong></p>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">In this example, multiple tables with 1:N relationship (t_order and t_order_line, t_order and t_order_coupon) are combined. As a result, if multiple records are stored in t_order_coupon, there is a duplication of list of <tt class="docutils literal"><span class="pre">Category</span></tt> objects stored in <tt class="docutils literal"><span class="pre">Item</span></tt> objects.</div>
<div class="line">In order to avoid this duplication, specify <tt class="docutils literal"><span class="pre">code</span></tt> property storing the value which uniquely identifies a category, in groupBy attribute. <tt class="docutils literal"><span class="pre">Category</span></tt> objects with same <tt class="docutils literal"><span class="pre">code</span></tt> property value are merged in one and thus preventing duplication.</div>
<div class="line">In this example, <tt class="docutils literal"><span class="pre">Category</span></tt> object <tt class="docutils literal"><span class="pre">code=CTG0000001</span></tt> is generated for <tt class="docutils literal"><span class="pre">Item#code=ITM0000001</span></tt> and 2 <tt class="docutils literal"><span class="pre">Category</span></tt> objects namely, <tt class="docutils literal"><span class="pre">code=CTG0000002</span></tt> and <tt class="docutils literal"><span class="pre">code=CTG0000003</span></tt> are generated for <tt class="docutils literal"><span class="pre">Item#code=ITM0000002</span></tt>. (Total 3 objects are generated.)</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><tt class="docutils literal"><span class="pre">item_code</span></tt> column values of fetched records are set in <tt class="docutils literal"><span class="pre">Item#code</span></tt>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><tt class="docutils literal"><span class="pre">item_name</span></tt> column values of fetched records are set in <tt class="docutils literal"><span class="pre">Item#name</span></tt>.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Mapping the records to <tt class="docutils literal"><span class="pre">OrderCoupon</span></tt> objects.</p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&quot;orderCouponResultMap&quot;</span> <span class="na">class=</span><span class="s">&quot;OrderCoupon&quot;</span> <span class="na">groupBy=</span><span class="s">&quot;couponCode&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;couponCode&quot;</span> <span class="na">column=</span><span class="s">&quot;coupon_code&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (2) --&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;coupon&quot;</span> <span class="na">resultMap=</span><span class="s">&quot;order.couponResultMap&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (3) --&gt;</span>
<span class="nt">&lt;/resultMap&gt;</span>
</pre></div>
</div>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/dataaccess_resultmap_ordercoupon.png"><img alt="ResultMap for OrderCoupon" src="../_images/dataaccess_resultmap_ordercoupon.png" style="width: 100%;" /></a>
<p class="caption"><strong>Picture - ResultMap for OrderCoupon</strong></p>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">It is necessary to specify groupBy attribute since there is a 1:N relationship between <tt class="docutils literal"><span class="pre">Order</span></tt> and <tt class="docutils literal"><span class="pre">OrderCoupon</span></tt>.</div>
<div class="line">Order coupons need to be grouped with the primary keys of t_order_coupon (order_id, coupon_code). However, order_id column is specified in the parent resultMap. Hence, specify only the  <tt class="docutils literal"><span class="pre">couponCode</span></tt> property that stores coupon_code column values here.</div>
<div class="line">In this example, as the order coupons are grouped in <tt class="docutils literal"><span class="pre">couponCode</span></tt> property, 2  <tt class="docutils literal"><span class="pre">OrderCoupon</span></tt>objects, namely, <tt class="docutils literal"><span class="pre">couponCode=CPN0000001</span></tt> and <tt class="docutils literal"><span class="pre">couponCode=CPN0000002</span></tt> are generated.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><tt class="docutils literal"><span class="pre">coupon_code</span></tt> column values of fetched records are set in <tt class="docutils literal"><span class="pre">OrderCoupon#couponCode</span></tt>.</div>
<div class="line"><tt class="docutils literal"><span class="pre">couponCode</span></tt> property overlaps with <tt class="docutils literal"><span class="pre">Coupon#code</span></tt> generated in (3). However, the property is required for grouping <tt class="docutils literal"><span class="pre">OrderCoupon</span></tt>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Delegate generation of <tt class="docutils literal"><span class="pre">Coupon</span></tt> object to <tt class="docutils literal"><span class="pre">id=&quot;order.couponResultMap&quot;</span></tt> resultMap and set the generated objects in <tt class="docutils literal"><span class="pre">OrderCoupon#coupon</span></tt>.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Mapping the records to <tt class="docutils literal"><span class="pre">Coupon</span></tt> objects</p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&quot;couponResultMap&quot;</span> <span class="na">class=</span><span class="s">&quot;Coupon&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;code&quot;</span> <span class="na">column=</span><span class="s">&quot;coupon_code&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (2) --&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;name&quot;</span> <span class="na">column=</span><span class="s">&quot;coupon_name&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (3) --&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&quot;price&quot;</span> <span class="na">column=</span><span class="s">&quot;coupon_price&quot;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- (4) --&gt;</span>
<span class="nt">&lt;/resultMap&gt;</span>
</pre></div>
</div>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/dataaccess_resultmap_coupon.png"><img alt="ResultMap for Coupon" src="../_images/dataaccess_resultmap_coupon.png" style="width: 100%;" /></a>
<p class="caption"><strong>Picture - ResultMap for Coupon</strong></p>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sr. No.</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">It is not necessary to specify groupBy attribute since there is a 1:1 relationship between <tt class="docutils literal"><span class="pre">OrderCoupon</span></tt> and <tt class="docutils literal"><span class="pre">Coupon</span></tt>.</div>
<div class="line">In this example, <tt class="docutils literal"><span class="pre">Coupon</span></tt> object of <tt class="docutils literal"><span class="pre">code=CPN0000001</span></tt>is generated for <tt class="docutils literal"><span class="pre">OrderCoupon#couponCode=CPN0000001</span></tt> and <tt class="docutils literal"><span class="pre">Coupon</span></tt> object of <tt class="docutils literal"><span class="pre">code=CPN0000001</span></tt> is generated for <tt class="docutils literal"><span class="pre">OrderCoupon#couponCode=CPN0000001</span></tt>. (Total 2 objects are generated.)</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><tt class="docutils literal"><span class="pre">coupon_code</span></tt> column values of fetched records are set in <tt class="docutils literal"><span class="pre">Coupon#code</span></tt>.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><tt class="docutils literal"><span class="pre">coupon_name</span></tt> column values of fetched records are set in <tt class="docutils literal"><span class="pre">Coupon#name</span></tt>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><tt class="docutils literal"><span class="pre">coupon_price</span></tt> column values of fetched records are set in <tt class="docutils literal"><span class="pre">Coupon#price</span></tt>.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line">Records and columns mapped to JavaBean are as follows:</div>
<div class="line">By specifying groupBy attribute, grayed out part is merged with the non-grayed part.</div>
</div>
<blockquote>
<div><div class="figure align-center">
<a class="reference internal image-reference" href="../_images/dataaccess_sql_result_used.png"><img alt="Valid Result Set for result mapping" src="../_images/dataaccess_sql_result_used.png" style="width: 100%;" /></a>
<p class="caption"><strong>Picture - Valid Result Set for result mapping</strong></p>
</div>
</div></blockquote>
<blockquote id="data-access-mybatis2-warning-sqlmapping-bulk">
<div><div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>It should be noted that when the records with 1:N relationship are mapped using JOINs, fetching the data of grayed out part becomes unnecessary.</p>
<p class="last">If the same SQL is used in a process that does not use data from the N part, it results in fetching of unnecessary data. Therefore, two separate SQLs, one that fetches the N part and another that does not fetch the N part should be created.</p>
</div>
</div></blockquote>
<p>The status of actually mapped  <tt class="docutils literal"><span class="pre">Order</span></tt> objects and related objects is as follows:</p>
<blockquote>
<div><div class="figure align-center">
<a class="reference internal image-reference" href="../_images/dataaccess_object.png"><img alt="Mapped object diagram" src="../_images/dataaccess_object.png" style="width: 90%;" /></a>
<p class="caption"><strong>Picture - Mapped object diagram</strong></p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>Another method to fetch related objects includes executing a separate SQL internally, using values of fetched records.
Implementing a separate SQL internally simplifies the definition of resultMap element and individual SQL to a great extent.
However, it is necessary to be aware of the fact that fetching related objects by this method can cause N+1.</p>
<p class="last">For details on how to execute a separate SQL internally, refer &#8220;Result Maps/Complex Properties&#8221; (P.36-37) and &#8220;Result Maps/Composite Keys or Multiple Complex Parameters Properties&#8221; (P.40-41) of Mybatis Developer Guide (PDF).</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>When a separate SQL is internally executed, related objects are &#8220;Eager Loaded&#8221;. As a result, SQL gets executed even when the related objects are not used.
To avoid this, Mybatis provides an option of &#8220;Lazy Load&#8221; for related objects.</p>
<p>Settings to enable &#8220;Lazy Load&#8221; are as follows:</p>
<ul class="last simple">
<li>Set the enhancementEnabled attribute of setting element of the Mybatis configuration file, to <tt class="docutils literal"><span class="pre">true</span></tt>.</li>
<li>Add CGLIB 2.x to class path.</li>
</ul>
</div>
</div></blockquote>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="ExclusionControl.html" title="5.5. Exclusive Control"
             >next</a> |</li>
        <li class="right" >
          <a href="DataAccessMyBatis3.html" title="5.3. Database Access (MyBatis3)"
             >previous</a> |</li>
        <li><a href="../index.html">TERASOLUNA Global Framework Development Guideline 5.0.0-SNAPSHOT documentation</a> &raquo;</li>
          <li><a href="index.html" >5. Architecture in Detail - TERASOLUNA Global Framework</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013-2015, NTT DATA.
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.Theme by <a href="http://github.com/vkvn">vkvn</a>
    </div>
    
    <script>
    
    $(function() {
    	var $sidebar	= $('.sphinxsidebar'),
    		$window		= $(window),
    		offset		= $sidebar.offset(),
    		topPadding	= 3,
    		$scroll		= $('#scroll');
    	
    	$window.scroll(function() {
    		if ($scroll.is(':checked')) {
				if ($window.scrollTop() > offset.top) {
					$sidebar.stop().animate({
						marginTop:$window.scrollTop() - offset.top + topPadding
					});
				} else {
					$sidebar.stop().animate({
						marginTop:0
					});
				}
			}
		});
    	
    	var $navList = $('ul:first', $sidebar);
    	$('li:first', $navList).addClass('open');
    	
    	$navList.treeview({
    		persist: "location",
    		collapsed: true,
    		unique: false
    	});
    	
	});
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-46550814-1', 'terasolunaorg.github.io');
    ga('send', 'pageview');
    </script>
  </body>
</html>